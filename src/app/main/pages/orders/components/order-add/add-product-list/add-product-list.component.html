<div id="add-product-list" class="center">
    <div class="content-card">
        <ng-container *ngIf="currentStepIdx == 0">
            <mat-toolbar-row class="p-0" fxLayoutAlign="space-between center">
                <p class="title-section">Add Product</p>
                <span class="spacer"></span>
                <button type="button" mat-icon-button aria-label="Close Dialog" mat-dialog-close>
                    <mat-icon>close</mat-icon>
                </button>
            </mat-toolbar-row>
        </ng-container>

        <ng-container *ngIf="currentStepIdx == 1">
            <mat-toolbar-row class="p-0" fxLayoutAlign="space-between center">
                <p class="title-section">Select Quantity</p>
                <span class="spacer"></span>
                <button type="button" mat-icon-button aria-label="Close Dialog" mat-dialog-close>
                    <mat-icon>close</mat-icon>
                </button>
            </mat-toolbar-row>
        </ng-container>

        <mat-horizontal-stepper
            labelPosition="bottom"
            (selectionChange)="onStepperChange($event)"
            #stepper
            ngClass="{{ 'last-edited-step-' + stepper.selectedIndex }}"
        >
            <mat-step color="primary">
                <ng-template matStepLabel>Select Product</ng-template>
                <div
                    class="menu"
                    style="display: flex; justify-content: space-between; height: 68px"
                >
                    <div class="title-add-product">
                        <p>Select Product</p>
                    </div>

                    <div>
                        <sinbad-search-bar
                            useBorder="true"
                            threshold="500"
                            fxFlexAlign="center"
                            fxFlex
                            (changed)="onSearch($event)"
                        ></sinbad-search-bar>
                    </div>
                </div>

                <mat-table
                    class="add-product-list-table sinbad-table"
                    [class.sinbad-table-no-record]="
                        !(isLoading$ | async) && (totalDataSource$ | async) === 0
                    "
                    #table
                    [dataSource]="dataSource$ | async"
                    matSort
                    [@animateStagger]="{ value: '50' }"
                    fusePerfectScrollbar
                >
                    <!-- SKU ID Column -->
                    <ng-container matColumnDef="order-sku-id">
                        <mat-header-cell *matHeaderCellDef> SKU ID </mat-header-cell>
                        <mat-cell *matCellDef="let row">
                            <p style="word-break: break-word; font-size: 14px">
                                {{ row?.catalogueId || '-' }}
                            </p>
                        </mat-cell>
                    </ng-container>

                    <!-- SKU Supplier Column -->
                    <ng-container matColumnDef="order-sku-supplier">
                        <mat-header-cell *matHeaderCellDef> SKU Supplier </mat-header-cell>
                        <mat-cell *matCellDef="let row">
                            <p style="word-break: break-word; font-size: 14px">
                                {{ row?.skuSupplier || '-' }}
                            </p>
                        </mat-cell>
                    </ng-container>

                    <!-- Product Name Column -->
                    <ng-container matColumnDef="order-product-name">
                        <mat-header-cell *matHeaderCellDef> Product Name </mat-header-cell>
                        <mat-cell *matCellDef="let row">
                            <img
                                alt="Product Images"
                                class="product-image"
                                [defaultImage]="sinbadNoPhoto"
                                [lazyLoad]="row?.productImage"
                                [errorImage]="sinbadNoPhoto"
                            />
                            <p style="word-break: break-word; font-size: 14px">
                                {{ row?.productName || '-' }}
                            </p>
                        </mat-cell>
                    </ng-container>

                    <!-- Price Column -->
                    <ng-container matColumnDef="order-price">
                        <mat-header-cell *matHeaderCellDef>
                            Price
                            <mat-icon
                                class="active-icon s-14 ml-8 cursor-pointer"
                                matTooltip="Applicable prices for store segmentation"
                                matTooltipPosition="above"
                                matTooltipClass="tooltip-br"
                                >info</mat-icon
                            >
                        </mat-header-cell>
                        <mat-cell *matCellDef="let row">
                            <ng-container *ngIf="row?.discountPrice > 0; else otherPrice">
                                <p style="word-break: break-word; font-size: 14px">
                                    {{ numberFormat(row?.discountPrice) }}
                                </p>
                                <p
                                    style="
                                        word-break: break-word;
                                        text-decoration: line-through;
                                        font-size: 12px;
                                        color: #677a8e;
                                    "
                                >
                                    {{ numberFormat(row?.price) }}
                                </p>
                            </ng-container>
                            <ng-template #otherPrice>
                                <p style="word-break: break-word; font-size: 14px">
                                    {{ numberFormat(row?.price) }}
                                </p>
                            </ng-template>
                        </mat-cell>
                    </ng-container>

                    <!-- Tax Column -->
                    <ng-container matColumnDef="order-tax">
                        <mat-header-cell *matHeaderCellDef> Tax </mat-header-cell>
                        <mat-cell *matCellDef="let row">
                            <p style="word-break: break-word; font-size: 14px">
                                <ng-container *ngIf="row?.tax; else noResultTax">
                                    {{ row?.tax }}%
                                </ng-container>
                                <ng-template #noResultTax> - </ng-template>
                            </p>
                        </mat-cell>
                    </ng-container>

                    <!-- Adv Price Column -->
                    <ng-container matColumnDef="adv-price">
                        <mat-header-cell *matHeaderCellDef> Adv. Price </mat-header-cell>
                        <mat-cell *matCellDef="let row">
                            <p style="word-break: break-word; font-size: 14px">
                                {{ numberFormat(row?.advancePrice) }}
                            </p>
                        </mat-cell>
                    </ng-container>

                    <!-- No Record Column -->
                    <ng-container matColumnDef="no-record">
                        <mat-footer-cell *matFooterCellDef colspan="8">{{
                            labelNoRecord
                        }}</mat-footer-cell>
                    </ng-container>

                    <mat-header-row
                        *matHeaderRowDef="displayedColumnsProductList; sticky: true"
                    ></mat-header-row>

                    <mat-row
                        *matRowDef="let row; columns: displayedColumnsProductList"
                        class="sinbad-add-product-list-table"
                        [ngClass]="{
                            'highlight-row': (selectedRowIndex$ | async) === row?.catalogueId
                        }"
                        matRipple
                        (click)="onClickDetail(row)"
                        [class.active]="highlightRow === row?.catalogueId"
                    ></mat-row>

                    <mat-footer-row
                        *matFooterRowDef="['no-record']"
                        [fxShow]="!(isLoading$ | async) && (totalDataSource$ | async) === 0"
                    ></mat-footer-row>
                </mat-table>

                <div
                    class="loader-content"
                    *ngIf="
                        (isLoading$ | async) &&
                        (!(totalDataSource$ | async) || (totalDataSource$ | async))
                    "
                >
                    <mat-spinner color="accent"></mat-spinner>
                </div>

                <mat-paginator
                    [disabled]="
                        ((isLoading$ | async) && !(totalDataSource$ | async)) ||
                        (!(isLoading$ | async) && (totalDataSource$ | async) === 0)
                    "
                    [length]="totalDataSource$ | async"
                    [pageSize]="defaultPageSize"
                    [pageSizeOptions]="defaultPageOpts"
                    showFirstLastButtons
                ></mat-paginator>

                <mat-dialog-actions align="end" style="margin-bottom: 0px">
                    <button
                        class="btn-cancel"
                        mat-button
                        [mat-dialog-close]="{ status: 'cancel' }"
                        mat-dialog-close
                    >
                        Cancel
                    </button>
                    <button
                        class="btn-submit"
                        (click)="onClickBtn('next')"
                        [disabled]="setDataProduct === null"
                        mat-button
                    >
                        Next
                    </button>
                </mat-dialog-actions>
            </mat-step>

            <!-- detail -->
            <mat-step [optional]="isOptional">
                <ng-template matStepLabel>Detail Product</ng-template>
                <!-- Task Setting -->

                <br />
                <!-- HEADER -->
                <div fxLayout="row" fxLayoutAlign="start center">
                    <button mat-icon-button class="mr-0" (click)="onClickBtn('back')">
                        <mat-icon>arrow_back</mat-icon>
                    </button>

                    <div
                        fxLayout="column"
                        fxLayoutAlign="start start"
                        [@animate]="{ value: '*', params: { delay: '100ms', x: '-25px' } }"
                    >
                        <ng-container *ngIf="setDataProduct != null; else imageEmp">
                            <img
                                alt="Product Images"
                                class="product-image-detail"
                                [defaultImage]="sinbadNoPhoto"
                                [lazyLoad]="setDataProduct.productImage"
                                [errorImage]="sinbadNoPhoto"
                            />
                        </ng-container>
                        <ng-template #imageEmp>
                            <img class="avatar" src="assets/images/avatars/default.png" />
                        </ng-template>
                    </div>
                    <div
                        fxLayout="column"
                        fxLayoutAlign="start start"
                        [@animate]="{ value: '*', params: { delay: '100ms', x: '-25px' } }"
                        style="margin-left: 10px"
                    >
                        <span class="title-detail">
                            <ng-container *ngIf="setDataProduct != null; else titleEmp">
                                {{ setDataProduct.productName }}
                            </ng-container>
                            <ng-template #titleEmp> - </ng-template>
                        </span>
                        <div class="subtitle secondary-text">
                            <span>SKU Details</span>
                        </div>
                    </div>
                </div>

                <hr />
                <!-- / HEADER -->
                <br />

                <span class="title-info-product">SKU & Sales Information</span>

                <div class="content">
                    <div class="tab-content">
                        <div class="horizontal" fxLayout="column" fxLayoutGap="16px">
                            <div class="box-info">
                                <div
                                    class="custom-field info-field"
                                    fxLayout="column"
                                    fxLayoutGap="0.5%"
                                >
                                    <div class="label">SKU ID</div>

                                    <div class="description">
                                        <ng-container
                                            *ngIf="setDataProduct != null; else catalogueEmp"
                                        >
                                            {{ setDataProduct.catalogueId }}
                                        </ng-container>
                                        <ng-template #catalogueEmp> - </ng-template>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="horizontal" fxLayout="column" fxLayoutGap="16px">
                            <div class="box-info">
                                <div
                                    class="custom-field info-field"
                                    fxLayout="column"
                                    fxLayoutGap="0.5%"
                                >
                                    <div class="label">SKU Supplier</div>

                                    <div class="description">
                                        <ng-container
                                            *ngIf="setDataProduct != null; else skuSupEmp"
                                        >
                                            {{ setDataProduct.skuSupplier }}
                                        </ng-container>
                                        <ng-template #skuSupEmp> - </ng-template>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="horizontal" fxLayout="column" fxLayoutGap="16px">
                            <div class="box-info">
                                <div
                                    class="custom-field info-field"
                                    fxLayout="column"
                                    fxLayoutGap="0.5%"
                                >
                                    <div class="label">Product Name</div>

                                    <div class="description">
                                        <ng-container
                                            *ngIf="setDataProduct != null; else prodNameEmp"
                                        >
                                            {{ setDataProduct.productName }}
                                        </ng-container>
                                        <ng-template #prodNameEmp> - </ng-template>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="horizontal" fxLayout="column" fxLayoutGap="16px">
                            <div class="box-info">
                                <div
                                    class="custom-field info-field"
                                    fxLayout="column"
                                    fxLayoutGap="0.5%"
                                >
                                    <div class="label">UOM</div>

                                    <div class="description">
                                        <ng-container *ngIf="setDataProduct != null; else uomEmp">
                                            {{ setDataProduct.UOM}}
                                        </ng-container>
                                        <ng-template #uomEmp> - </ng-template>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-content" style="padding-left: 16px">
                        <div class="horizontal" fxLayout="column" fxLayoutGap="16px">
                            <div class="box-info">
                                <div
                                    class="custom-field info-field"
                                    fxLayout="column"
                                    fxLayoutGap="0.5%"
                                >
                                    <div class="label">Tax</div>

                                    <div class="description">
                                        <ng-container *ngIf="setDataProduct != null; else taxEmp">
                                            {{ setDataProduct.tax
                                            }}<ng-container
                                                *ngIf="setDataProduct.taxType === 'percent'"
                                                >%</ng-container
                                            >
                                        </ng-container>
                                        <ng-template #taxEmp> - </ng-template>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="horizontal" fxLayout="column" fxLayoutGap="16px">
                            <div class="box-info">
                                <div
                                    class="custom-field info-field"
                                    fxLayout="column"
                                    fxLayoutGap="0.5%"
                                >
                                    <div class="label">Retail Buyer Price (Before Tax)</div>

                                    <div class="description">
                                        <ng-container *ngIf="setDataProduct != null; else priceEmp">
                                            {{ numberFormat(setDataProduct.price) }}
                                        </ng-container>
                                        <ng-template #priceEmp> - </ng-template>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="horizontal" fxLayout="column" fxLayoutGap="16px">
                            <div class="box-info">
                                <div
                                    class="custom-field info-field"
                                    fxLayout="column"
                                    fxLayoutGap="0.5%"
                                >
                                    <div class="label">Discount Price</div>

                                    <div class="description">
                                        <ng-container
                                            *ngIf="setDataProduct != null; else discountPriceEmp"
                                        >
                                            {{ numberFormat(setDataProduct.discountPrice) }}
                                        </ng-container>
                                        <ng-template #discountPriceEmp> - </ng-template>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="horizontal" fxLayout="column" fxLayoutGap="16px">
                            <div class="box-info">
                                <div
                                    class="custom-field info-field"
                                    fxLayout="column"
                                    fxLayoutGap="0.5%"
                                >
                                    <div class="label">Adv.Price</div>

                                    <div class="description">
                                        <ng-container
                                            *ngIf="setDataProduct != null; else advancePriceEmp"
                                        >
                                            {{ numberFormat(setDataProduct.advancePrice) }}
                                        </ng-container>
                                        <ng-template #advancePriceEmp> - </ng-template>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="footer-detail">
                    <div>
                        <div style="display: flex">
                            <div style="display: flex">
                                <ng-container *ngIf="setDataProduct != null; else noDataProd">
                                    <button
                                        class="btn-minus"
                                        (click)="decrement(setDataProduct.multipleQty)"
                                        mat-button
                                        [disabled]="statMinQty"
                                    >
                                        <span style="font-size: 20px">-</span>
                                    </button>
                                    <form flex [formGroup]="form">
                                        <mat-form-field class="qty-input" appearance="outline">
                                            <input
                                                type="text"
                                                matInput
                                                placeholder="0"
                                                formControlName="qtyValue"
                                                (keyup)="keyUpQty($event)"
                                                style="font-size: 14px; color: #677a8e; text-align: center;"
                                            />
                                        </mat-form-field>
                                    </form>
                                    <button
                                        class="btn-plus"
                                        (click)="increment(setDataProduct.multipleQty)"
                                        mat-button
                                        [disabled]="statMaxQty"
                                    >
                                        <span style="font-size: 20px">+</span>
                                    </button>
                                </ng-container>
                                <ng-template #noDataProd> - </ng-template>
                            </div>
                            <div class="row" style="margin-left: 10px">
                                <div>
                                    <span class="subtitle secondary-text">Total: </span>
                                    <span class="totalRpSty">Rp{{ priceFormat(totalRp) }}</span>
                                </div>
                                <div class="subtitle secondary-text">
                                    <span>({{ totalQty }})</span>  <ng-container *ngIf="setDataProduct !== null">{{setDataProduct.UOM}}</ng-container> 
                                </div>
                            </div>
                        </div>
                        <ng-container *ngIf="statusLabel">
                            <div style="display: flex; margin-top: 10px">
                                <ng-container *ngIf="statusError === 'stock'">
                                    <span class="totalRpSty">out of stock (stock={{ stock }})</span>
                                </ng-container>
                                <ng-container *ngIf="statusError === 'minqty'">
                                    <span class="totalRpSty">minimum Qty {{ minQty }}</span>
                                </ng-container>
                                <ng-container *ngIf="statusError === 'maxqty'">
                                    <span class="totalRpSty">maximum Qty {{ maxQty }}</span>
                                </ng-container>
                                <ng-container *ngIf="statusError === 'multiple'">
                                    <span class="totalRpSty">please input multiple {{ multipleQty }}</span>
                                </ng-container>
                            </div>
                        </ng-container>
                    </div>

                    <mat-dialog-actions align="end" style="margin-bottom: 0px">
                        <button
                            class="btn-cancel"
                            mat-button
                            [mat-dialog-close]="{ status: 'cancel' }"
                            mat-dialog-close
                        >
                            Cancel
                        </button>
                        <button
                            class="btn-submit"
                            mat-button
                            [disabled]="(totalQty <= 0 && totalRp === 0) || statusLabel"
                            (click)="onClickSubmit()"
                            mat-dialog-close
                        >
                            Submit
                        </button>
                    </mat-dialog-actions>
                </div>

                <!-- End Task Setting -->
            </mat-step>
        </mat-horizontal-stepper>
    </div>
</div>
