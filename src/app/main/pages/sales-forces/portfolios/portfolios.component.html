<div id="portfolios" class="page-layout carded fullwidth inner-scroll" fusePerfectScrollbar>
    <!-- CONTENT -->
    <div class="center p-8" fxLayout="column" fxLayoutGap="20px">
        <!-- TABLES -->
        <div class="content-card">
            <sinbad-card-header [config]="cardHeaderConfig">
                <div class="h-32" fxLayout="row" fxLayout="start center" fxLayoutGap="16px" first-bottom-left>
                    <button fxFlexAlign="center" mat-flat-button class="h-32 sinbad-red" [routerLink]="'/pages/sales-force/portfolio/group/add'">Add Group</button>
                    <button fxFlexAlign="center" mat-flat-button class="h-32 sinbad-red" [routerLink]="'/pages/sales-force/portfolio/direct/add'">Add Direct</button>
                    <span fxFlexAlign="center">
                        <a (click)="openPortfolioExplanation()" class="sinbad-red-fg" style="cursor: pointer;">What is this?</a>
                    </span>
                </div>
            </sinbad-card-header>

            <mat-table class="portfolios-table grey-300-border mx-12" #table [dataSource]="portfolios" matSort
                [@animateStagger]="{ value: '50' }" fusePerfectScrollbar>
                <!-- Checkbox Column -->
                <ng-container matColumnDef="checkbox">
                    <mat-header-cell *matHeaderCellDef>
                        <mat-checkbox (change)="$event ? masterToggle() : null" (click)="$event.stopPropagation()"
                            [checked]="selection.hasValue() && isAllSelected()"
                            [indeterminate]="selection.hasValue() && !isAllSelected()"></mat-checkbox>
                    </mat-header-cell>

                    <mat-cell *matCellDef="let row">
                        <mat-checkbox (click)="$event.stopPropagation()"
                            (change)="$event ? selection.toggle(row) : null" [checked]="selection.isSelected(row)">
                        </mat-checkbox>
                    </mat-cell>
                </ng-container>

                <!-- "Portfolio Code" Column -->
                <ng-container matColumnDef="code">
                    <mat-header-cell *matHeaderCellDef mat-sort-header>
                        Portfolio Code
                    </mat-header-cell>
                    <mat-cell *matCellDef="let row">
                        <p>
                            {{ row?.code || '-' }}
                        </p>
                    </mat-cell>
                </ng-container>

                <!-- "Portfolio Name" Column -->
                <ng-container matColumnDef="name">
                    <mat-header-cell *matHeaderCellDef mat-sort-header>Portfolio Name</mat-header-cell>
                    <mat-cell *matCellDef="let row">
                        <p>{{ row?.name }}</p>
                    </mat-cell>
                </ng-container>

                <!-- "Sales Force" Column -->
                <ng-container matColumnDef="salesForce">
                    <mat-header-cell *matHeaderCellDef>Sales Rep.</mat-header-cell>
                    <mat-cell *matCellDef="let row">
                        <p class="word-wrap">{{ row?.user?.fullName || '-' }}</p>
                    </mat-cell>
                </ng-container>

                <!-- Timestamp Column -->
                <ng-container matColumnDef="timestamp">
                    <mat-header-cell *matHeaderCellDef>Last Update Portfolio</mat-header-cell>
                    <mat-cell *matCellDef="let row">
                        <p class="text-truncate">{{ row?.updatedAt | date }}</p>
                    </mat-cell>
                </ng-container>

                <!-- Actions Column -->
                <ng-container matColumnDef="actions">
                    <mat-header-cell *matHeaderCellDef>
                        Actions
                    </mat-header-cell>

                    <mat-cell class="pr-8" *matCellDef="let row">
                        <div fxFlex="row" fxLayoutAlign="end center">
                            <button mat-icon-button [matMenuTriggerFor]="moreMenu" aria-label="More"
                                (click)="$event.stopPropagation()">
                                <mat-icon class="secondary-text">more_vert</mat-icon>
                            </button>

                            <mat-menu #moreMenu="matMenu">
                                <ng-template [ngxPermissionsOnly]="['SRM.PFO.UPDATE']">
                                    <button mat-menu-item type="button" class="sinbad-mat-menu-item" aria-label="edit"
                                        (click)="editPortfolio(row.id)">
                                        <mat-icon>edit</mat-icon>
                                        <span>Edit</span>
                                    </button>
                                </ng-template>
                            </mat-menu>
                        </div>
                    </mat-cell>
                </ng-container>

                <mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></mat-header-row>

                <mat-row matRipple *matRowDef="let row; columns: displayedColumns" (click)="viewPortfolio(row?.id)"
                    class="portfolio"></mat-row>
            </mat-table>

            <div class="no-records" *ngIf="!(isLoading$ | async) && portfolios.length === 0">
                No records found
            </div>


            <mat-paginator [length]="totalPortfolios$ | async" [pageSize]="defaultPageSize"
                [pageSizeOptions]="[5, 10, 25, 100]" (page)="onChangePage($event)" showFirstLastButtons>
            </mat-paginator>

            <div class="loader" *ngIf="(isLoading$ | async) || (isRequestingExport$ | async)">
                <mat-spinner color="accent"></mat-spinner>
            </div>
        </div>
        <!-- / TABLES -->
    </div>
    <!-- / CONTENT -->
</div>

<ng-template #portfolioExplanation>
    <div fxLayout="row" fxLayoutAlign="start stretch" fxLayoutGap="32px" fxFlex>
        <!-- Group -->
        <div class="ml-16" fxLayout="column" fxLayoutAlign="start stretch" fxFlex>
            <!-- TITLE -->
            <p class="text-semibold">
                Group
            </p>
            <!-- / TITLE -->
            <!-- DESCRIPTION -->
            <p>
                Preset your portfolio with stores in it.
                You can create connection between sales rep and stores through portfolio group.
            </p>
            <!-- / DESCRIPTION -->
            <!-- ILLUSTRATION -->
            <div class="p-8 text-center sinbad-black-10-border" style="border: 1px solid; border-radius: 4px;" fxFlex>
                <img class="w-85-p h-85-p" src="assets/images/sales-force/portfolios/group_portfolio.png" />
            </div>
            <!-- / ILLUSTRATION -->
        </div>
        <!-- / Group -->
        <!-- Direct -->
        <div class="mr-16" fxLayout="column" fxLayoutAlign="start stretch" fxFlex>
            <!-- TITLE -->
            <p class="text-semibold">
                Direct
            </p>
            <!-- / TITLE -->
            <!-- DESCRIPTION -->
            <p>
                Create portfolio (platform), so the salesman can only create toko in restricted area.
            </p>
            <!-- / DESCRIPTION -->
            <!-- ILLUSTRATION -->
            <div class="p-8 text-center sinbad-black-10-border" style="border: 1px solid; border-radius: 4px;" fxFlex>
                <img class="mt-24 w-85-p h-85-p" src="assets/images/sales-force/portfolios/direct_portfolio.png" />
            </div>
            <!-- / ILLUSTRATION -->
        </div>
        <!-- / Direct -->
    </div>
</ng-template>