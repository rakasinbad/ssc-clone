<h2 mat-dialog-title *ngIf="data?.title">
    {{ data?.title | titlecase }}
</h2>

<mat-dialog-content class="mat-typography" style="min-width: 50em;">
    <form
        id="credit-limit-group-form"
        class="w-100-p"
        [formGroup]="form"
        (ngSubmit)="onSubmit(pageType)"
        fxLayout="column"
        fxFlex
        novalidate
    >
        <div class="form-box">
            <span class="mat-subheading-2">
                Credit Limit & Balance
            </span>

            <div class="custom-field" fxLayout="row" fxLayoutAlign="space-between stretch">
                <label
                    fxFlexAlign="center"
                    fxFlex="15"
                    [class.mat-error]="
                        form.get('groupName').errors &&
                        !form.get('groupName').untouched &&
                        (form.get('groupName').dirty || form.get('groupName').touched)
                    "
                >
                    *Credit Limit Group Name
                </label>

                <mat-form-field appearance="outline" fxFlex="70">
                    <!-- <span matPrefix>Rp &nbsp;</span> -->
                    <input
                        matInput
                        name="groupName"
                        formControlName="groupName"
                        placeholder="Input credit limit group name"
                    />

                    <mat-error
                        *ngIf="
                            form.get('groupName').errors &&
                            (form.get('groupName').dirty || form.get('groupName').touched)
                        "
                    >
                        {{ getErrorMessage('groupName') }}
                    </mat-error>
                </mat-form-field>
            </div>

            <div class="custom-field" fxLayout="row" fxLayoutAlign="space-between stretch">
                <label
                    fxFlexAlign="center"
                    fxFlex="15"
                    [class.mat-error]="
                        form.get('creditAmount').errors &&
                        !form.get('creditAmount').untouched &&
                        (form.get('creditAmount').dirty || form.get('creditAmount').touched)
                    "
                >
                    *Credit Limit Amount
                </label>

                <mat-form-field appearance="outline" fxFlex="70">
                    <!-- <span matPrefix>Rp &nbsp;</span> -->
                    <input
                        matInput
                        name="creditAmount"
                        formControlName="creditAmount"
                        mask="separator.2"
                        thousandSeparator="."
                        prefix="Rp"
                        placeholder="Rp"
                    />

                    <mat-error
                        *ngIf="
                            form.get('creditAmount').errors &&
                            (form.get('creditAmount').dirty || form.get('creditAmount').touched)
                        "
                    >
                        {{ getErrorMessage('creditAmount') }}
                    </mat-error>
                </mat-form-field>
            </div>

            <!-- <div class="custom-field" fxLayout="row" fxLayoutAlign="space-between stretch">
                <label
                    fxFlexAlign="center"
                    fxFlex="15"
                    [class.mat-error]="
                        form.get('startingBalance').errors &&
                        !form.get('startingBalance').untouched &&
                        (form.get('startingBalance').dirty || form.get('startingBalance').touched)
                    "
                >
                    Set Starting Balance
                </label>

                <mat-form-field appearance="outline" fxFlex="70">
                    <input
                        matInput
                        name="startingBalance"
                        formControlName="startingBalance"
                        mask="separator.2"
                        thousandSeparator="."
                        prefix="Rp"
                        placeholder="Rp"
                    />

                    <mat-error
                        *ngIf="
                            form.get('startingBalance').errors &&
                            (form.get('startingBalance').dirty ||
                                form.get('startingBalance').touched)
                        "
                    >
                        {{ getErrorMessage('startingBalance') }}
                    </mat-error>
                </mat-form-field>
            </div> -->

            <div class="custom-field" fxLayout="row" fxLayoutAlign="space-between stretch">
                <label
                    fxFlexAlign="center"
                    fxFlex="15"
                    [class.mat-error]="
                        form.get('storeSegment').errors &&
                        !form.get('storeSegment').untouched &&
                        (form.get('storeSegment').dirty || form.get('storeSegment').touched)
                    "
                >
                    *Segment
                </label>

                <mat-form-field appearance="outline" fxFlex="70">
                    <!-- <span matPrefix>Rp &nbsp;</span> -->
                    <!-- <mat-select formControlName="storeSegment" placeholder="Choose segment...">
                        <mat-option>GT</mat-option>
                    </mat-select> -->

                    <ng-container
                        *ngIf="
                            !(isDropdownErrors$('fetchDropdownStoreSegmentFailure') | async);
                            else noStoreSegmentsErr
                        "
                    >
                        <ng-container
                            *ngIf="storeSegments$ | async as storeSegments; else noStoreSegments"
                        >
                            <mat-select
                                formControlName="storeSegment"
                                placeholder="Choose Store Segment"
                            >
                                <mat-option *ngFor="let row of storeSegments" [value]="row?.id">
                                    {{ row?.name | uppercase }}
                                </mat-option>
                            </mat-select>
                        </ng-container>
                    </ng-container>

                    <ng-template #noStoreSegments>
                        <mat-select placeholder="Choose Store Segment" disabled>
                            <mat-option>Store Segment not found</mat-option>
                        </mat-select>
                    </ng-template>

                    <ng-template #noStoreSegmentsErr>
                        <mat-select placeholder="Store Segment not found" disabled>
                            <mat-option>Store Segment not found</mat-option>
                        </mat-select>
                    </ng-template>

                    <mat-error
                        *ngIf="
                            form.get('storeSegment').errors &&
                            (form.get('storeSegment').dirty || form.get('storeSegment').touched)
                        "
                    >
                        {{ getErrorMessage('storeSegment') }}
                    </mat-error>
                </mat-form-field>
            </div>

            <div class="custom-field" fxLayout="row" fxLayoutAlign="space-between stretch">
                <label
                    fxFlexAlign="center"
                    fxFlex="15"
                    [class.mat-error]="
                        form.get('hierarchy').errors &&
                        !form.get('hierarchy').untouched &&
                        (form.get('hierarchy').dirty || form.get('hierarchy').touched)
                    "
                >
                    *Customer Hierarchy
                </label>

                <mat-form-field appearance="outline" fxFlex="70">
                    <!-- <span matPrefix>Rp &nbsp;</span> -->
                    <!-- <mat-select
                        formControlName="customerHierarchy"
                        placeholder="Choose customer hierarchy..."
                    >
                        <mat-option>GT</mat-option>
                    </mat-select> -->

                    <ng-container
                        *ngIf="
                            !(isDropdownErrors$('fetchDropdownHierarchyFailure') | async);
                            else noHierarchiesErr
                        "
                    >
                        <ng-container
                            *ngIf="hierarchies$ | async as hierarchies; else noHierarchies"
                        >
                            <mat-select formControlName="hierarchy" placeholder="Choose Hierarchy">
                                <mat-option *ngFor="let row of hierarchies" [value]="row?.id">
                                    {{ row?.name | uppercase }}
                                </mat-option>
                            </mat-select>
                        </ng-container>
                    </ng-container>

                    <ng-template #noHierarchies>
                        <mat-select placeholder="Choose Hierarchy" disabled>
                            <mat-option>Customer Hierarchy not found</mat-option>
                        </mat-select>
                    </ng-template>

                    <ng-template #noHierarchiesErr>
                        <mat-select placeholder="Customer Hierarchy not found" disabled>
                            <mat-option>Customer Hierarchy not found</mat-option>
                        </mat-select>
                    </ng-template>

                    <mat-error
                        *ngIf="
                            form.get('hierarchy').errors &&
                            (form.get('hierarchy').dirty || form.get('hierarchy').touched)
                        "
                    >
                        {{ getErrorMessage('hierarchy') }}
                    </mat-error>
                </mat-form-field>
            </div>

            <div class="custom-field" fxLayout="row" fxLayoutAlign="space-between stretch">
                <label
                    fxFlexAlign="center"
                    fxFlex="15"
                    [class.mat-error]="
                        form.get('termOfPayment').errors &&
                        !form.get('termOfPayment').untouched &&
                        (form.get('termOfPayment').dirty || form.get('termOfPayment').touched)
                    "
                >
                    *Term of Payment
                </label>

                <mat-form-field appearance="outline" fxFlex="70">
                    <!-- <span matPrefix>Rp &nbsp;</span> -->
                    <input
                        matInput
                        name="termOfPayment"
                        formControlName="termOfPayment"
                        suffix=" days"
                        mask="0*"
                        placeholder="In days"
                    />

                    <mat-error
                        *ngIf="
                            form.get('termOfPayment').errors &&
                            (form.get('termOfPayment').dirty || form.get('termOfPayment').touched)
                        "
                    >
                        {{ getErrorMessage('termOfPayment') }}
                    </mat-error>
                </mat-form-field>
            </div>
        </div>

        <div class="form-box dynamic">
            <div fxLayout="row" fxLayoutAlign="space-between stretch">
                <span class="mat-subheading-2" fxFlex="15">
                    *Geographic
                </span>

                <mat-radio-group
                    formControlName="unitParameterType"
                    aria-label="Select an option"
                    fxFlex="70"
                    (change)="onChangeGeoStatus($event)"
                >
                    <mat-radio-button *ngFor="let row of unitParameterTypes" [value]="row?.id">
                        {{ row?.label }}
                    </mat-radio-button>
                </mat-radio-group>
            </div>

            <ng-container *ngIf="form.get('unitParameterType').value !== 'all'">
                <div
                    class="custom-field dynamic"
                    fxLayout="row"
                    fxLayoutAlign="space-between stretch"
                    formArrayName="creditLimitArea"
                    *ngFor="let creditLimitArea of geoControls; index as i"
                >
                    <ng-container [formGroupName]="i">
                        <label
                            fxFlex="15"
                            [class.mat-error]="
                                formGeographics.controls[i].get('unitType').errors &&
                                !formGeographics.controls[i].get('unitType').untouched &&
                                (formGeographics.controls[i].get('unitType').dirty ||
                                    formGeographics.controls[i].get('unitType').touched)
                            "
                        >
                            Geographic {{ i + 1 }}
                        </label>

                        <div
                            class="bg-f9f9f9 px-4"
                            fxLayout="column"
                            fxLayoutAlign="center stretch"
                            fxFlex="70"
                        >
                            <button
                                mat-icon-button
                                matTooltip="Block"
                                color="accent"
                                style="position: relative;align-self: flex-end;"
                                *ngIf="!i"
                                disabled
                            >
                                <mat-icon>block</mat-icon>
                            </button>

                            <button
                                mat-icon-button
                                type="button"
                                matTooltip="Delete"
                                color="accent"
                                style="position: relative;align-self: flex-end;"
                                *ngIf="i"
                                (click)="onDeleteGeoParameter(i)"
                            >
                                <mat-icon>remove_circle_outline</mat-icon>
                            </button>

                            <div
                                fxLayout="row"
                                fxLayoutAlign="start center"
                                fxLayoutGap="15px"
                                fxFlex="70"
                            >
                                <label fxFlexAlign="center" fxFlex="15">
                                    Set Unit
                                </label>

                                <mat-form-field appearance="outline" fxFlex="70">
                                    <ng-container *ngIf="unitParameters; else noUnitParameters">
                                        <mat-select
                                            formControlName="unitType"
                                            placeholder="Pick your parameter"
                                            (selectionChange)="onSelectUnit($event, i)"
                                        >
                                            <mat-option
                                                *ngFor="let row of unitParameters"
                                                [value]="row?.id"
                                            >
                                                {{ row?.label }}
                                            </mat-option>
                                        </mat-select>
                                    </ng-container>

                                    <ng-template #noUnitParameters>
                                        <mat-select placeholder="Pick your parameter" disabled>
                                            <mat-option>Parameter not found</mat-option>
                                        </mat-select>
                                    </ng-template>

                                    <mat-error
                                        *ngIf="
                                            formGeographics.controls[i].get('unitType').errors &&
                                            (formGeographics.controls[i].get('unitType').dirty ||
                                                formGeographics.controls[i].get('unitType').touched)
                                        "
                                    >
                                        {{ getErrorMessageArray('creditLimitArea', 'unitType', i) }}
                                    </mat-error>
                                </mat-form-field>
                            </div>

                            <div
                                fxLayout="row"
                                fxLayoutAlign="start center"
                                fxLayoutGap="15px"
                                fxFlex="70"
                            >
                                <label fxFlexAlign="center" fxFlex="15">
                                    Set Value
                                </label>

                                <mat-form-field appearance="outline" fxFlex="70">
                                    <ng-container
                                        *ngIf="
                                            geoParameterSource$[i] | async as parameterSources;
                                            else noSources
                                        "
                                    >
                                        <mat-select
                                            formControlName="unitValue"
                                            placeholder="Pick your parameter"
                                        >
                                            <mat-option
                                                *ngFor="let value of parameterSources?.source"
                                                [value]="value"
                                            >
                                                {{ value }}
                                            </mat-option>
                                        </mat-select>
                                    </ng-container>

                                    <ng-template #noSources>
                                        <mat-select placeholder="Pick your parameter" disabled>
                                            <mat-option>Parameter not found</mat-option>
                                        </mat-select>
                                    </ng-template>

                                    <mat-error
                                        *ngIf="
                                            formGeographics.controls[i].get('unitValue').errors &&
                                            (formGeographics.controls[i].get('unitValue').dirty ||
                                                formGeographics.controls[i].get('unitValue')
                                                    .touched)
                                        "
                                    >
                                        {{
                                            getErrorMessageArray('creditLimitArea', 'unitValue', i)
                                        }}
                                    </mat-error>
                                </mat-form-field>
                            </div>
                        </div>
                    </ng-container>
                </div>
            </ng-container>
        </div>

        <div class="form-box mb-4" *ngIf="form.get('unitParameterType').value !== 'all'">
            <div class="custom-field" fxLayout="row" fxLayoutAlign="space-between stretch">
                <div fxFlex="15"></div>

                <div
                    class="btn-sinbad-outline py-8"
                    fxLayout="row"
                    fxLayoutAlign="center center"
                    fxLayoutGap="10px"
                    fxFlex="70"
                    (click)="onAddGeograph()"
                >
                    <mat-icon>add_circle</mat-icon>
                    <span>Add</span>
                </div>
            </div>
        </div>
    </form>
    <!-- <p [innerHTML]="data?.message"></p>
    <form [formGroup]="form">
        <mat-form-field appearance="outline" floatLabel="always" class="w-100-p date-form" *ngIf="!(data?.range)">
            <mat-label>Date</mat-label>

            <input matInput [matDatepicker]="dpFilterDate" formControlName="filterDate" />

            <mat-datepicker-toggle matSuffix [for]="dpFilterDate"></mat-datepicker-toggle>
            <mat-datepicker touchUi #dpFilterDate disabled="false"></mat-datepicker>
        </mat-form-field>

        <mat-form-field appearance="outline" floatLabel="always" class="w-100-p date-form" *ngIf="data?.range">
            <mat-label>Start Date</mat-label>

            <input matInput
                   [matDatepicker]="dpStartDate"
                   [min]="minStartDate"
                   [max]="maxStartDate"
                   (dateChange)="onChangeStartDate($event)"
                   (dateInput)="onInputStartDate($event)"
                   formControlName="startDate" />

            <mat-datepicker-toggle matSuffix [for]="dpStartDate"></mat-datepicker-toggle>
            <mat-datepicker touchUi #dpStartDate disabled="false"></mat-datepicker>

            <mat-error *ngIf="form.get('startDate').invalid && (form.get('startDate').dirty || form.get('startDate').touched)">
                {{getErrorMessage('startDate', 'start_date')}}
            </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" floatLabel="always" class="w-100-p date-form" *ngIf="data?.range">
            <mat-label>End Date</mat-label>

            <input matInput
                   [matDatepicker]="dpEndDate"
                   [min]="minEndDate"
                   [max]="maxEndDate"
                   formControlName="endDate" />

            <mat-datepicker-toggle matSuffix [for]="dpEndDate"></mat-datepicker-toggle>
            <mat-datepicker touchUi #dpEndDate [disabled]="!form.get('startDate').value"></mat-datepicker>

            <mat-error *ngIf="form.get('endDate').invalid && (form.get('endDate').dirty || form.get('endDate').touched)">
                {{getErrorMessage('endDate', 'end_date')}}
            </mat-error>
        </mat-form-field>
    </form> -->
</mat-dialog-content>

<mat-dialog-actions align="end">
    <span fxLayout="row" fxLayoutGap="10px">
        <button
            mat-flat-button
            type="submit"
            color="accent"
            [attr.cdkFocusInitial]="form.valid"
            [disabled]="pageType === 'edit' ? form.invalid || form.pristine : form.invalid"
            form="credit-limit-group-form"
        >
            Simpan
        </button>
        <button mat-stroked-button mat-dialog-close>Tutup</button>
    </span>
</mat-dialog-actions>
