<!-- <div fxLayout="row" fxLayoutAlign="start center" class="tab-container">
    <div
        class="button-tab-custom"
        [class.button-tab-custom-active]="activeTab === 'all'"
        (click)="clickTab('all')"
    >
        <span>All</span>
    </div>
    <div
        class="button-tab-custom"
        [class.button-tab-custom-active]="activeTab === 'active'"
        (click)="clickTab('active')"
    >
        <span>Active</span>
    </div>
    <div
        class="button-tab-custom"
        [class.button-tab-custom-active]="activeTab === 'inactive'"
        (click)="clickTab('inactive')"
    >
        <span>Inactive</span>
    </div>
</div> -->

<mat-tab-group
    color="accent"
    class="sinbad-mat-tab-group"
    (selectedTabChange)="onSelectedTab($event)"
>
    <mat-tab label="All">
        <!-- <ng-template matTabContent>
            <div class="tab-content p-16" fxLayout="column" fusePerfectScrollbar></div>
        </ng-template> -->
    </mat-tab>

    <mat-tab label="Active" [disabled]="isLoading$ | async">
        <!-- <ng-template matTabContent>
            <div class="tab-content p-16" fxLayout="column" fusePerfectScrollbar></div>
        </ng-template> -->
    </mat-tab>

    <mat-tab label="Inactive" [disabled]="isLoading$ | async">
        <!-- <ng-template matTabContent>
            <div class="tab-content p-16" fxLayout="column" fusePerfectScrollbar></div>
        </ng-template> -->
    </mat-tab>
</mat-tab-group>

<mat-table
    class="flexi-combo-list-table sinbad-table"
    [class.sinbad-table-no-record]="!(isLoading$ | async) && (totalDataSource$ | async) === 0"
    #table
    [dataSource]="dataSource$ | async"
    matSort
    [@animateStagger]="{ value: '50' }"
    fusePerfectScrollbar
>
    <!-- Checkbox Column -->
    <ng-container matColumnDef="checkbox">
        <mat-header-cell *matHeaderCellDef>
            <mat-checkbox></mat-checkbox>
            <!-- <mat-checkbox
                (change)="$event ? handleCheckbox() : null"
                (click)="$event.stopPropagation()"
                [checked]="selection.hasValue() && isAllSelected()"
                [indeterminate]="selection.hasValue() && !isAllSelected()"
            ></mat-checkbox> -->
        </mat-header-cell>
        <mat-cell *matCellDef="let row">
            <mat-checkbox></mat-checkbox>
            <!-- <mat-checkbox
                (click)="$event.stopPropagation()"
                (change)="$event ? selection.toggle(row) : null"
                [checked]="selection.isSelected(row)"
            ></mat-checkbox> -->
        </mat-cell>
    </ng-container>

    <!-- Promo Seller Id Column -->
    <ng-container matColumnDef="promo-seller-id">
        <mat-header-cell *matHeaderCellDef>
            Promo Seller Id
        </mat-header-cell>
        <mat-cell *matCellDef="let row">
            <p class="text-word-break-break-word">
                {{ row?.externalId || '-' }}
            </p>
        </mat-cell>
    </ng-container>

    <!-- Promo Name Column -->
    <ng-container matColumnDef="promo-name">
        <mat-header-cell *matHeaderCellDef>
            Promo Name
        </mat-header-cell>
        <mat-cell *matCellDef="let row">
            <p class="text-word-break-break-word">
                {{ row?.name || '-' }}
            </p>
        </mat-cell>
    </ng-container>

        <!-- Promo Type Column -->
        <ng-container matColumnDef="promo-type">
            <mat-header-cell *matHeaderCellDef> Promo Type </mat-header-cell>
            <mat-cell *matCellDef="let row">
                <p class="text-word-break-break-word">
                    {{ (row?.type | titlecase) || '-' }}
                </p>
            </mat-cell>
        </ng-container>
    
         <!-- Promo Allocation Column -->
         <ng-container matColumnDef="promo-allocation">
            <mat-header-cell *matHeaderCellDef> Promo Allocation </mat-header-cell>
            <mat-cell *matCellDef="let row">
                 <!-- for promo type none -->
                <ng-container *ngIf="row.promoAllocationType === 'none'">
                    <p class="text-word-break-break-word">
                        None
                    </p>
                </ng-container>

                <!-- for promo type budget -->
                <ng-container *ngIf="row.promoAllocationType === 'promo_budget'">
                    <p class="text-word-break-break-word">
                        Max Promo Redemption<br />(Rp)
                    </p>
                </ng-container>

                <!-- for promo type slot -->
                <ng-container *ngIf="row.promoAllocationType === 'promo_slot'">
                        <p class="text-word-break-break-word">
                            Max Promo Redemption<br />(transaction)
                        </p>
                </ng-container>
            </mat-cell>
        </ng-container>
    
         <!-- Allocation Value Column -->
        <ng-container matColumnDef="allocation-value">
            <mat-header-cell *matHeaderCellDef> Allocation Value </mat-header-cell>
            <mat-cell *matCellDef="let row">
                 <!-- for promo type none -->
                 <ng-container *ngIf="row.promoAllocationType === 'none'">
                    <p class="text-word-break-break-word">
                        -
                    </p>
                </ng-container>

                <!-- for promo type budget -->
                <ng-container *ngIf="row.promoAllocationType === 'promo_budget'">
                    <p class="text-word-break-break-word" thousandSeparator=".">
                        Rp {{ (row?.promoBudget | number) || '-' }} / Rp {{ (row?.planBudget | number) || '-' }}
                    </p>
                </ng-container>

                <!-- for promo type slot -->
                <ng-container *ngIf="row.promoAllocationType === 'promo_slot'">
                    <p class="text-word-break-break-word">
                        {{ row?.promoSlot || '-' }} / {{ row?.planSlot || '-' }}
                    </p>
                </ng-container>
            </mat-cell>
        </ng-container>

    <!-- Base Column -->
    <ng-container matColumnDef="base">
        <mat-header-cell *matHeaderCellDef>
            Base
        </mat-header-cell>
        <mat-cell *matCellDef="let row">
            <p class="text-word-break-break-word">
                <ng-container [ngSwitch]="row?.base">
                    <ng-container *ngSwitchCase="eTriggerBase.SKU">
                        SKU
                    </ng-container>

                    <ng-container *ngSwitchCase="eTriggerBase.BRAND">
                        Brand
                    </ng-container>

                    <ng-container *ngSwitchCase="eTriggerBase.INVOICE">
                        Faktur
                    </ng-container>

                    <ng-container *ngSwitchDefault>-</ng-container>
                </ng-container>
            </p>
        </mat-cell>
    </ng-container>

    <!-- Start Date Column -->
    <ng-container matColumnDef="start-date">
        <mat-header-cell *matHeaderCellDef>
            Start Date
        </mat-header-cell>
        <mat-cell *matCellDef="let row">
            <p class="text-word-break-break-word">
                {{ (row?.startDate | date: 'dd/MM/yyyy') || '-' }}
            </p>
        </mat-cell>
    </ng-container>

    <!-- End Date Column -->
    <ng-container matColumnDef="end-date">
        <mat-header-cell *matHeaderCellDef>
            End Date
        </mat-header-cell>
        <mat-cell *matCellDef="let row">
            <p class="text-word-break-break-word">
                {{ (row?.endDate | date: 'dd/MM/yyyy') || '-' }}
            </p>
        </mat-cell>
    </ng-container>

    <!-- Status Column -->
    <ng-container matColumnDef="status">
        <mat-header-cell *matHeaderCellDef>
            Status
        </mat-header-cell>
        <mat-cell *matCellDef="let row">
            <ng-container *ngIf="row?.status">
                <mat-icon
                    class="active-icon s-24"
                    [matTooltip]="row?.status | titlecase"
                    svgIcon="sinbad-check-active"
                    *ngIf="row?.status === 'active'"
                >
                </mat-icon>

                <mat-icon
                    class="active-icon s-24"
                    [matTooltip]="row?.status | titlecase"
                    svgIcon="sinbad-check-inactive"
                    *ngIf="row?.status === 'inactive'"
                >
                </mat-icon>
            </ng-container>

            <ng-container *ngIf="!row?.status">
                -
            </ng-container>
        </mat-cell>
    </ng-container>

    <!-- Actions Column -->
    <ng-container matColumnDef="actions">
        <mat-header-cell *matHeaderCellDef>
            Actions
        </mat-header-cell>
        <mat-cell *matCellDef="let row">
            <div fxFlex="row" fxLayoutAlign="end center">
                <button
                    mat-icon-button
                    [matMenuTriggerFor]="moreMenu"
                    aria-label="More"
                    (click)="$event.stopPropagation()"
                >
                    <mat-icon class="secondary-text">more_vert</mat-icon>
                </button>

                <mat-menu #moreMenu="matMenu">
                    <ng-template [ngxPermissionsOnly]="['SRM.SR.UPDATE']">
                        <!-- <button
                            type="button"
                            mat-menu-item
                            class="sinbad-mat-menu-item"
                            aria-label="Detail"
                            [routerLink]="[row?.id, 'detail']"
                        >
                            <mat-icon>info</mat-icon>
                            <span>Detail</span>
                        </button> -->

                        <button
                            type="button"
                            [disabled]="isDisabled(row.status, row.endDate)"
                            mat-menu-item
                            class="sinbad-mat-menu-item"
                            aria-label="Extend"
                            (click)="onExtend(row)"
                        >
                            <mat-icon>edit</mat-icon>
                            <span>Extend</span>
                        </button>

                        <button
                            mat-menu-item
                            type="button"
                            class="sinbad-mat-menu-item"
                            [attr.aria-label]="row?.status === 'active' ? 'Inactive' : 'Active'"
                            (click)="onChangeStatus(row)"
                        >
                            <mat-icon>
                                {{ row?.status === 'active' ? 'archive' : 'check_circle_outline' }}
                            </mat-icon>
                            <span>
                                {{
                                    (row?.status === 'active'
                                        ? 'ACTION.INACTIVE'
                                        : 'ACTION.ACTIVE'
                                    ) | translate
                                }}
                            </span>
                        </button>

                        <button
                            type="button"
                            mat-menu-item
                            class="sinbad-mat-menu-item"
                            aria-label="remove"
                            (click)="onDelete(row)"
                        >
                            <mat-icon>delete</mat-icon>
                            <span>Remove</span>
                        </button>
                    </ng-template>
                </mat-menu>
            </div>
        </mat-cell>
    </ng-container>

    <!-- No Record Column -->
    <ng-container matColumnDef="no-record">
        <mat-footer-cell *matFooterCellDef colspan="8">
            No records found
        </mat-footer-cell>
    </ng-container>

    <mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></mat-header-row>
    <mat-row
        *matRowDef="let row; columns: displayedColumns"
        class="flexi-combo-list"
        [routerLink]="[row?.id, 'detail']"
    ></mat-row>
    <mat-footer-row
        *matFooterRowDef="['no-record']"
        [fxShow]="!(isLoading$ | async) && (totalDataSource$ | async) === 0"
    ></mat-footer-row>
</mat-table>

<div
    class="loader-content"
    *ngIf="(isLoading$ | async) && (!(totalDataSource$ | async) || (totalDataSource$ | async))"
>
    <mat-spinner color="accent"></mat-spinner>
</div>

<mat-paginator
    [disabled]="
        ((isLoading$ | async) && !(totalDataSource$ | async)) ||
        (!(isLoading$ | async) && (totalDataSource$ | async) === 0)
    "
    [length]="totalDataSource$ | async"
    [pageSize]="defaultPageSize"
    [pageSizeOptions]="defaultPageOpts"
    showFirstLastButtons
></mat-paginator>
