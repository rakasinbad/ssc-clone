<div
    id="flexi-combo"
    class="page-layout carded fullwidth inner-scroll"
    cdkScrollable
    fusePerfectScrollbar
>
    <!-- TOP BACKGROUND -->
    <div class="accent"></div>
    <!-- / TOP BACKGROUND -->

    <!-- CENTER -->
    <div class="center p-8">
        <form
            id="flexi-combo-form"
            name="flexiComboForm"
            class="merchant w-100-p"
            [formGroup]="form"
            autocomplete="off"
            fxLayout="column"
            fxFlex
            novalidate
        >
            <mat-card class="mb-24">
                <div fxLayout="column">
                    <span class="mat-headline">
                        General Information
                    </span>

                    <div class="form-box">
                        <div
                            class="custom-field"
                            fxLayout="row"
                            fxLayoutAlign="start stretch"
                            fxLayoutGap="16px"
                        >
                            <label
                                fxFlexAlign="center"
                                fxFlex="10"
                                [class.sinbad-red-fg]="hasError('promoId')"
                            >
                                Promo Seller ID
                            </label>

                            <mat-form-field appearance="outline" fxFlex="50">
                                <input
                                    matInput
                                    name="promoId"
                                    formControlName="promoId"
                                    autocapitalize="characters"
                                />

                                <mat-error *ngIf="hasError('promoId', true)">
                                    {{ getErrorMessage('promoId') }}
                                </mat-error>
                            </mat-form-field>
                        </div>

                        <div
                            class="custom-field"
                            fxLayout="row"
                            fxLayoutAlign="start stretch"
                            fxLayoutGap="16px"
                        >
                            <label
                                fxFlexAlign="center"
                                fxFlex="10"
                                [class.sinbad-red-fg]="hasError('promoName')"
                            >
                                <span class="sinbad-red-fg">*</span>
                                Promo Name
                            </label>

                            <mat-form-field appearance="outline" fxFlex="50">
                                <input
                                    matInput
                                    name="promoName"
                                    formControlName="promoName"
                                    autocapitalize="words"
                                />

                                <mat-error *ngIf="hasError('promoName', true)">
                                    {{ getErrorMessage('promoName') }}
                                </mat-error>
                            </mat-form-field>
                        </div>

                        <div
                            class="custom-field"
                            fxLayout="row"
                            fxLayoutAlign="start stretch"
                            fxLayoutGap="16px"
                        >
                            <label
                                fxFlexAlign="center"
                                fxFlex="10"
                                [class.sinbad-red-fg]="hasError('platform')"
                            >
                                <span class="sinbad-red-fg">*</span>
                                Platform
                            </label>

                            <mat-form-field appearance="outline" fxFlex="50">
                                <ng-container *ngIf="platformsSinbad; else noPlatformsSinbad">
                                    <mat-select
                                        formControlName="platform"
                                        placeholder="Choose Platform"
                                    >
                                        <mat-option>None</mat-option>
                                        <mat-option
                                            *ngFor="let row of platformsSinbad"
                                            [value]="row.id"
                                        >
                                            {{ row.label }}
                                        </mat-option>
                                    </mat-select>
                                </ng-container>

                                <ng-template #noPlatformsSinbad>
                                    <mat-select placeholder="Platform not found" disabled>
                                        <mat-option>None</mat-option>
                                    </mat-select>
                                </ng-template>

                                <mat-error *ngIf="hasError('platform', true)">
                                    {{ getErrorMessage('platform') }}
                                </mat-error>
                            </mat-form-field>
                        </div>

                        <div
                            class="custom-field"
                            fxLayout="row"
                            fxLayoutAlign="start stretch"
                            fxLayoutGap="16px"
                        >
                            <label
                                fxFlexAlign="center"
                                fxFlex="10"
                                [class.sinbad-red-fg]="hasError('maxRedemption')"
                            >
                                Max Redemption<br />per Buyer
                            </label>

                            <mat-form-field appearance="outline" fxFlex="50">
                                <input
                                    matInput
                                    name="maxRedemption"
                                    mask="0*"
                                    formControlName="maxRedemption"
                                />

                                <mat-error *ngIf="hasError('maxRedemption', true)">
                                    {{ getErrorMessage('maxRedemption') }}
                                </mat-error>
                            </mat-form-field>
                        </div>

                        <div
                            class="custom-field"
                            fxLayout="row"
                            fxLayoutAlign="start stretch"
                            fxLayoutGap="16px"
                        >
                            <label
                                fxFlexAlign="center"
                                fxFlex="10"
                                [class.sinbad-red-fg]="hasError('promoBudget')"
                            >
                                Promo Budget
                            </label>

                            <mat-form-field appearance="outline" fxFlex="50">
                                <input
                                    matInput
                                    name="promoBudget"
                                    formControlName="promoBudget"
                                    mask="separator.2"
                                    thousandSeparator="."
                                    prefix="Rp"
                                    placeholder="Rp"
                                />

                                <mat-error *ngIf="hasError('promoBudget', true)">
                                    {{ getErrorMessage('promoBudget') }}
                                </mat-error>
                            </mat-form-field>
                        </div>

                        <div
                            class="custom-field"
                            fxLayout="row"
                            fxLayoutAlign="start stretch"
                            fxLayoutGap="16px"
                        >
                            <label
                                fxFlexAlign="center"
                                fxFlex="10"
                                [class.sinbad-red-fg]="hasError('startDate')"
                            >
                                <span class="sinbad-red-fg">*</span>
                                Active From
                            </label>

                            <mat-form-field appearance="outline" fxFlex="50">
                                <input
                                    matInput
                                    [matDatetimepicker]="startDatePicker"
                                    [max]="maxStartDate"
                                    [min]="minStartDate"
                                    (dateChange)="onChangeStartDate($event)"
                                    autocomplete="off"
                                    name="startDate"
                                    formControlName="startDate"
                                />
                                <mat-datetimepicker-toggle
                                    matSuffix
                                    [for]="startDatePicker"
                                ></mat-datetimepicker-toggle>
                                <mat-datetimepicker
                                    touchUi
                                    #startDatePicker
                                    [disabled]="false"
                                    type="datetime"
                                >
                                </mat-datetimepicker>

                                <mat-error *ngIf="hasError('startDate', true)">
                                    {{ getErrorMessage('startDate') }}
                                </mat-error>
                            </mat-form-field>
                        </div>

                        <div
                            class="custom-field"
                            fxLayout="row"
                            fxLayoutAlign="start stretch"
                            fxLayoutGap="16px"
                        >
                            <label
                                fxFlexAlign="center"
                                fxFlex="10"
                                [class.sinbad-red-fg]="hasError('endDate')"
                            >
                                <span class="sinbad-red-fg">*</span>
                                To
                            </label>

                            <mat-form-field appearance="outline" fxFlex="50">
                                <input
                                    matInput
                                    [matDatetimepicker]="endDatePicker"
                                    [max]="maxEndDate"
                                    [min]="minEndDate"
                                    (dateChange)="onChangeEndDate($event)"
                                    autocomplete="off"
                                    name="endDate"
                                    formControlName="endDate"
                                />
                                <mat-datetimepicker-toggle
                                    matSuffix
                                    [for]="endDatePicker"
                                ></mat-datetimepicker-toggle>
                                <mat-datetimepicker
                                    touchUi
                                    #endDatePicker
                                    [disabled]="false"
                                    type="datetime"
                                >
                                </mat-datetimepicker>

                                <mat-error *ngIf="hasError('endDate', true)">
                                    {{ getErrorMessage('endDate') }}
                                </mat-error>
                            </mat-form-field>
                        </div>

                        <div
                            class="custom-field"
                            fxLayout="row"
                            fxLayoutAlign="start stretch"
                            fxLayoutGap="16px"
                        >
                            <label
                                fxFlexAlign="center"
                                fxFlex="10"
                                [class.sinbad-red-fg]="hasError('endDate')"
                            >
                                Image Suggestion

                                <mat-icon
                                    class="active-icon s-14 ml-8 cursor-pointer"
                                    color="accent"
                                    matTooltip="Image Suggestion"
                                    matTooltipClass="tooltip-br"
                                >
                                    help
                                </mat-icon>
                            </label>

                            <div fxLayout="row" fxFlex="100" fxLayoutAlign="start center">
                                <mat-form-field
                                    class="sinbad-file-field"
                                    appearance="outline"
                                    fxFlex="43.5"
                                    [class.mat-sinbad-field-error]="hasError('imgSuggestion')"
                                >
                                    <input
                                        #imgSuggestionPicker
                                        type="file"
                                        class="custom-file"
                                        accept=".jpg, .jpeg, .png"
                                        formControlName="imgSuggestion"
                                        (click)="imgSuggestionPicker.value = null"
                                        (change)="onFileBrowse($event, 'imgSuggestion')"
                                        autocomplete="off"
                                    />
                                    <input
                                        matInput
                                        [formControl]="tmp.imgSuggestion"
                                        [value]="
                                            tmp.imgSuggestion.value && tmp.imgSuggestion.value.name
                                                ? tmp.imgSuggestion.value.name
                                                : null
                                        "
                                        placeholder="No file choose"
                                        autocomplete="off"
                                    />

                                    <mat-hint
                                        class="mat-error"
                                        *ngIf="hasError('imgSuggestion', true)"
                                    >
                                        {{ getErrorMessage('imgSuggestion') }}
                                    </mat-hint>
                                </mat-form-field>

                                <button
                                    type="button"
                                    mat-flat-button
                                    color="accent"
                                    (click)="imgSuggestionPicker.click()"
                                    fxFlexAlign="center"
                                >
                                    Upload Your File
                                </button>

                                <!-- <ng-container
                                    *ngIf="pageType === 'edit' && (stores$ | async) as stores"
                                >
                                    <a
                                        [href]="stores?.imageUrl"
                                        target="_blank"
                                        *ngIf="stores?.imageUrl"
                                        style="position: relative; top: -0.78em;"
                                    >
                                        <mat-icon>remove_red_eye</mat-icon>
                                    </a>
                                </ng-container> -->
                            </div>
                        </div>

                        <div
                            class="custom-field mt-8"
                            fxLayout="row"
                            fxLayoutAlign="start stretch"
                            fxLayoutGap="16px"
                        >
                            <label fxFlexAlign="center" fxFlex="10"> </label>

                            <div fxFlexAlign="center" fxFlex="50">
                                <mat-checkbox formControlName="allowCombineWithVoucher">
                                    Allow Combine With Voucher

                                    <mat-icon
                                        class="active-icon s-14 ml-8 cursor-pointer"
                                        color="accent"
                                        matTooltip="If you choose to allow combine with&#10;voucher, users are allowed to use&#10;promo and voucher for the same purchase."
                                        matTooltipClass="tooltip-br"
                                    >
                                        help
                                    </mat-icon>
                                </mat-checkbox>

                                <mat-checkbox formControlName="firstBuy">
                                    First Buy

                                    <mat-icon
                                        class="active-icon s-14 ml-8 cursor-pointer"
                                        color="accent"
                                        matTooltip="If you activate first buy, this promo&#10;will only be activated when the&#10;customer buy for the first time only."
                                        matTooltipClass="tooltip-br"
                                    >
                                        help
                                    </mat-icon>
                                </mat-checkbox>
                            </div>
                        </div>
                    </div>
                </div>
            </mat-card>

            <mat-card class="mb-24">
                <div fxLayout="column">
                    <span class="mat-headline">
                        Trigger
                    </span>

                    <div class="form-box">
                        <div
                            class="custom-field"
                            fxLayout="row"
                            fxLayoutAlign="start stretch"
                            fxLayoutGap="16px"
                        >
                            <label
                                fxFlexAlign="center"
                                fxFlex="10"
                                [class.sinbad-red-fg]="hasError('base')"
                                fxFill
                            >
                                <span class="sinbad-red-fg">*</span>
                                Base
                            </label>

                            <!-- <mat-form-field appearance="outline" fxFlex="50" class="form-info">
                                <input matInput style="display: none;" />

                                <ng-container *ngIf="triggerBase; else noTriggerBase">
                                    <mat-radio-group formControlName="base">
                                        <mat-radio-button
                                            *ngFor="let row of triggerBase"
                                            [value]="row?.id"
                                        >
                                            {{ row?.label }}
                                        </mat-radio-button>
                                    </mat-radio-group>
                                </ng-container>

                                <ng-template #noTriggerBase>
                                    -
                                </ng-template>

                                <mat-hint class="mat-error" *ngIf="hasError('base', true)">
                                    {{ getErrorMessage('base') }}
                                </mat-hint>
                            </mat-form-field> -->

                            <div fxFlexAlign="center" fxFlex="50" fxFill>
                                <ng-container *ngIf="triggerBase; else noTriggerBase">
                                    <mat-radio-group formControlName="base">
                                        <mat-radio-button
                                            *ngFor="let row of triggerBase"
                                            [value]="row?.id"
                                        >
                                            {{ row?.label }}
                                        </mat-radio-button>
                                    </mat-radio-group>
                                </ng-container>

                                <ng-template #noTriggerBase>
                                    -
                                </ng-template>

                                <mat-hint class="mat-error" *ngIf="hasError('base', true)">
                                    {{ getErrorMessage('base') }}
                                </mat-hint>
                            </div>
                        </div>

                        <div
                            class="custom-field"
                            fxLayout="row"
                            fxLayoutAlign="start stretch"
                            fxLayoutGap="16px"
                        >
                            <label
                                fxFlexAlign="center"
                                fxFlex="10"
                                [class.sinbad-red-fg]="hasError('chosenSku')"
                            >
                                <span class="sinbad-red-fg">*</span>
                                Chosen SKU<br />
                                ({{ form.get('chosenSku').value?.length || 0 }} Selected)
                            </label>

                            <select-catalogues
                                [required]="true"
                                (selected)="onSkuSelected($event)"
                                fxFlex="50"
                            >
                                <div error>
                                    {{ getErrorMessage('chosenSku') }}
                                </div>
                            </select-catalogues>
                        </div>
                    </div>
                </div>
            </mat-card>

            <mat-card class="mb-24">
                <div fxLayout="column">
                    <span class="mat-headline">
                        Condition & Benefit Settings
                    </span>

                    <div class="form-box">
                        <div
                            class="custom-field"
                            fxLayout="row"
                            fxLayoutAlign="start stretch"
                            fxLayoutGap="16px"
                        >
                            <label fxFlexAlign="center" fxFlex="10">
                                Calculation Mechanism
                            </label>

                            <div fxFlexAlign="center" fxFlex="50">
                                <ng-container
                                    *ngIf="calculationMechanism; else noCalculationMechanism"
                                >
                                    <mat-radio-group formControlName="calculationMechanism">
                                        <mat-radio-button
                                            *ngFor="let row of calculationMechanism"
                                            [value]="row?.id"
                                            [disabled]="row?.id === 'cumulative'"
                                        >
                                            {{ row?.label }}
                                        </mat-radio-button>
                                    </mat-radio-group>
                                </ng-container>

                                <ng-template #noCalculationMechanism>
                                    -
                                </ng-template>

                                <a href="javascript:;">What is this?</a>
                            </div>
                        </div>

                        <ng-container formArrayName="conditions">
                            <!-- START DYNAMIC BOX-GROUP -->
                            <div
                                class="box-group"
                                fxLayout="column"
                                fxLayoutGap="16px"
                                *ngFor="
                                    let condition of conditionsCtrl;
                                    index as conditionIdx;
                                    first as isFirst
                                "
                                [formGroupName]="conditionIdx"
                            >
                                <span
                                    class="field-head-wrapper"
                                    fxLayout="row"
                                    fxLayoutAlign="space-between stretch"
                                >
                                    <span class="box-title" fxFlexAlign="center">
                                        {{ 'Tier ' + (conditionIdx + 1) }}
                                    </span>

                                    <button
                                        type="button"
                                        mat-icon-button
                                        *ngIf="!isFirst"
                                        class="sinbad-black-40-fg"
                                        (click)="deleteCondition(conditionIdx)"
                                    >
                                        <mat-icon>delete</mat-icon>
                                    </button>
                                </span>

                                <div fxLayout="row" fxLayoutAlign="start stretch">
                                    <!-- START FIELD-WRAPPER -->
                                    <div
                                        class="field-wrapper p-16"
                                        fxLayout="column"
                                        fxLayoutAlign="start stretch"
                                        fxFlex="1 1 auto"
                                    >
                                        <span class="field-title">
                                            Condition

                                            <mat-icon
                                                class="active-icon s-14 ml-8 cursor-pointer"
                                                color="accent"
                                                matTooltip="Define the condition need to be&#10;fulfilled by your customer so that&#10;they will be eligible for the promo&#10;program."
                                                matTooltipClass="tooltip-br"
                                            >
                                                help
                                            </mat-icon>
                                        </span>

                                        <!-- START FIELD TIER CONDITION BASE -->
                                        <div
                                            class="custom-field"
                                            fxLayout="row"
                                            fxLayoutAlign="start stretch"
                                            fxLayoutGap="16px"
                                        >
                                            <label
                                                fxFlexAlign="center"
                                                fxFlex="16"
                                                [class.sinbad-red-fg]="
                                                    hasError([
                                                        'conditions',
                                                        conditionIdx,
                                                        'conditionBase'
                                                    ])
                                                "
                                                fxFill
                                            >
                                                <span class="sinbad-red-fg">*</span>
                                                Base
                                            </label>

                                            <div fxFlexAlign="center" fxFlex="50" fxFill>
                                                <ng-container
                                                    *ngIf="conditionBase; else noConditionBase"
                                                >
                                                    <mat-radio-group
                                                        formControlName="conditionBase"
                                                    >
                                                        <mat-radio-button
                                                            *ngFor="let row of conditionBase"
                                                            [value]="row?.id"
                                                        >
                                                            {{ row?.label }}
                                                        </mat-radio-button>
                                                    </mat-radio-group>
                                                </ng-container>

                                                <ng-template #noConditionBase>
                                                    -
                                                </ng-template>

                                                <mat-hint
                                                    class="mat-error"
                                                    *ngIf="
                                                        hasError(
                                                            [
                                                                'conditions',
                                                                conditionIdx,
                                                                'conditionBase'
                                                            ],
                                                            true
                                                        )
                                                    "
                                                >
                                                    {{
                                                        getErrorMessage(
                                                            'conditionBase',
                                                            'conditions',
                                                            conditionIdx
                                                        )
                                                    }}
                                                </mat-hint>
                                            </div>
                                        </div>
                                        <!-- ./ FIELD TIER CONDITION BASE -->

                                        <!-- SWITCH CASE LAYOUT CONDITION VALUE -->
                                        <ng-container [ngSwitch]="getConditionBase(conditionIdx)">
                                            <ng-container *ngSwitchCase="eConditionBase.QTY">
                                                <!-- START FIELD TIER CONDITION VALUE (QTY) -->
                                                <div
                                                    class="custom-field"
                                                    fxLayout="row"
                                                    fxLayoutAlign="start stretch"
                                                    fxLayoutGap="16px"
                                                >
                                                    <label
                                                        fxFlexAlign="center"
                                                        fxFlex="16"
                                                        [class.sinbad-red-fg]="
                                                            hasError([
                                                                'conditions',
                                                                conditionIdx,
                                                                'conditionQty'
                                                            ])
                                                        "
                                                    >
                                                        <span class="sinbad-red-fg">*</span>
                                                        Qty >=
                                                    </label>

                                                    <mat-form-field
                                                        appearance="outline"
                                                        fxFlex="60"
                                                    >
                                                        <input
                                                            matInput
                                                            [attr.name]="
                                                                'conditionQty' + conditionIdx
                                                            "
                                                            mask="0*"
                                                            formControlName="conditionQty"
                                                        />

                                                        <mat-error
                                                            *ngIf="
                                                                hasError(
                                                                    [
                                                                        'conditions',
                                                                        conditionIdx,
                                                                        'conditionQty'
                                                                    ],
                                                                    true
                                                                )
                                                            "
                                                        >
                                                            {{
                                                                getErrorMessage(
                                                                    'conditionQty',
                                                                    'conditions',
                                                                    conditionIdx
                                                                )
                                                            }}
                                                        </mat-error>
                                                    </mat-form-field>
                                                </div>
                                                <!-- ./ FIELD TIER CONDITION VALUE (QTY) -->
                                            </ng-container>
                                            <ng-container
                                                *ngSwitchCase="eConditionBase.ORDER_VALUE"
                                            >
                                                <!-- START FIELD TIER CONDITION VALUE (ORDER VALUE) -->
                                                <div
                                                    class="custom-field"
                                                    fxLayout="row"
                                                    fxLayoutAlign="start stretch"
                                                    fxLayoutGap="16px"
                                                >
                                                    <label
                                                        fxFlexAlign="center"
                                                        fxFlex="16"
                                                        [class.sinbad-red-fg]="
                                                            hasError([
                                                                'conditions',
                                                                conditionIdx,
                                                                'conditionValue'
                                                            ])
                                                        "
                                                    >
                                                        <span class="sinbad-red-fg">*</span>
                                                        Order Value >=
                                                    </label>

                                                    <mat-form-field
                                                        appearance="outline"
                                                        fxFlex="60"
                                                    >
                                                        <input
                                                            matInput
                                                            [attr.name]="
                                                                'conditionValue' + conditionIdx
                                                            "
                                                            formControlName="conditionValue"
                                                            mask="separator.2"
                                                            thousandSeparator="."
                                                            prefix="Rp"
                                                            placeholder="Rp"
                                                        />

                                                        <mat-error
                                                            *ngIf="
                                                                hasError(
                                                                    [
                                                                        'conditions',
                                                                        conditionIdx,
                                                                        'conditionValue'
                                                                    ],
                                                                    true
                                                                )
                                                            "
                                                        >
                                                            {{
                                                                getErrorMessage(
                                                                    'conditionValue',
                                                                    'conditions',
                                                                    conditionIdx
                                                                )
                                                            }}
                                                        </mat-error>
                                                    </mat-form-field>
                                                </div>
                                                <!-- ./ FIELD TIER CONDITION VALUE (ORDER VALUE) -->
                                            </ng-container>
                                        </ng-container>
                                        <!-- ./ SWITCH CASE LAYOUT CONDITION VALUE -->

                                        <span class="field-title">
                                            Benefit

                                            <mat-icon
                                                class="active-icon s-14 ml-8 cursor-pointer"
                                                color="accent"
                                                matTooltip="Define the benefit of your promo&#10;program that will be granted to your&#10;customers here."
                                                matTooltipClass="tooltip-br"
                                            >
                                                help
                                            </mat-icon>
                                        </span>

                                        <!-- START FIELD TIER BENEFIT TYPE -->
                                        <div
                                            class="custom-field"
                                            fxLayout="row"
                                            fxLayoutAlign="start stretch"
                                            fxLayoutGap="16px"
                                        >
                                            <label fxFlexAlign="center" fxFlex="16" fxFill>
                                                Benefit Type
                                            </label>

                                            <div fxFlexAlign="center" fxFlex="60" fxFill>
                                                <ng-container
                                                    *ngIf="benefitType; else noBenefitType"
                                                >
                                                    <mat-radio-group formControlName="benefitType">
                                                        <mat-radio-button
                                                            *ngFor="let row of benefitType"
                                                            [value]="row?.id"
                                                        >
                                                            {{ row?.label }}
                                                        </mat-radio-button>
                                                    </mat-radio-group>
                                                </ng-container>

                                                <ng-template #noBenefitType>
                                                    -
                                                </ng-template>

                                                <mat-hint
                                                    class="mat-error"
                                                    *ngIf="
                                                        hasError(
                                                            [
                                                                'conditions',
                                                                conditionIdx,
                                                                'benefitType'
                                                            ],
                                                            true
                                                        )
                                                    "
                                                >
                                                    {{
                                                        getErrorMessage(
                                                            'benefitType',
                                                            'conditions',
                                                            conditionIdx
                                                        )
                                                    }}
                                                </mat-hint>
                                            </div>
                                        </div>
                                        <!-- ./ FIELD TIER BENEFIT TYPE -->

                                        <!-- SWITCH CASE LAYOUT BENEFIT TYPE -->
                                        <ng-container [ngSwitch]="getBenefitType(conditionIdx)">
                                            <ng-container *ngSwitchCase="eBenefitType.QTY">
                                                <!-- START FIELD TIER BONUS SKU -->
                                                <div
                                                    class="custom-field"
                                                    fxLayout="row"
                                                    fxLayoutAlign="start stretch"
                                                    fxLayoutGap="16px"
                                                >
                                                    <label
                                                        fxFlexAlign="center"
                                                        fxFlex="16"
                                                        [class.sinbad-red-fg]="
                                                            hasError([
                                                                'conditions',
                                                                conditionIdx,
                                                                'benefitCatalogueId'
                                                            ])
                                                        "
                                                    >
                                                        <span class="sinbad-red-fg">*</span>
                                                        Bonus SKU
                                                    </label>

                                                    <select-catalogues
                                                        mode="single"
                                                        [disabled]="
                                                            isDisabledBonusSku(conditionIdx)
                                                        "
                                                        [initialSelection]="
                                                            getApplyBonusSku(conditionIdx)
                                                        "
                                                        [required]="true"
                                                        (selected)="
                                                            onBenefitSkuSelected($event, [
                                                                'conditions',
                                                                conditionIdx,
                                                                'benefitCatalogueId'
                                                            ])
                                                        "
                                                        fxFlex="60"
                                                    >
                                                        <div error>
                                                            {{
                                                                getErrorMessage(
                                                                    'benefitCatalogueId',
                                                                    'conditions',
                                                                    conditionIdx
                                                                )
                                                            }}
                                                        </div>
                                                    </select-catalogues>
                                                </div>
                                                <!-- ./ FIELD TIER BONUS SKU -->

                                                <!-- START FIELD TIER APPLY SAME SKU -->
                                                <div
                                                    class="custom-field mt-12"
                                                    fxLayout="row"
                                                    fxLayoutAlign="start stretch"
                                                    fxLayoutGap="16px"
                                                    *ngIf="isFirst && canApplySameSku()"
                                                >
                                                    <label fxFlexAlign="center" fxFlex="16"></label>

                                                    <div fxFlexAlign="center" fxFlex="60">
                                                        <mat-checkbox
                                                            formControlName="applySameSku"
                                                            (change)="
                                                                onChangeApplySameSku(
                                                                    $event,
                                                                    conditionIdx
                                                                )
                                                            "
                                                        >
                                                            Apply Same SKU
                                                        </mat-checkbox>
                                                    </div>
                                                </div>
                                                <!-- ./ FIELD TIER APPLY SAME SKU -->

                                                <!-- START FIELD TIER BONUS QTY -->
                                                <div
                                                    class="custom-field"
                                                    fxLayout="row"
                                                    fxLayoutAlign="start stretch"
                                                    fxLayoutGap="16px"
                                                >
                                                    <label
                                                        fxFlexAlign="center"
                                                        fxFlex="16"
                                                        [class.sinbad-red-fg]="
                                                            hasError('promoBudget')
                                                        "
                                                    >
                                                        Bonus Qty
                                                    </label>

                                                    <mat-form-field
                                                        appearance="outline"
                                                        fxFlex="60"
                                                    >
                                                        <input
                                                            matInput
                                                            [attr.name]="
                                                                'benefitBonusQty' + conditionIdx
                                                            "
                                                            formControlName="benefitBonusQty"
                                                            mask="0*"
                                                            autocomplete="off"
                                                        />

                                                        <mat-error
                                                            *ngIf="hasError('promoBudget', true)"
                                                        >
                                                            {{ getErrorMessage('promoBudget') }}
                                                        </mat-error>
                                                    </mat-form-field>
                                                </div>
                                                <!-- ./ FIELD TIER BONUS QTY -->

                                                <!-- START FIELD TIER MULTIPLICATION -->
                                                <div
                                                    class="custom-field"
                                                    fxLayout="row"
                                                    fxLayoutAlign="start stretch"
                                                    fxLayoutGap="16px"
                                                >
                                                    <label fxFlexAlign="center" fxFlex="16"></label>

                                                    <div fxFlexAlign="center" fxFlex="60">
                                                        <mat-checkbox
                                                            formControlName="multiplication"
                                                        >
                                                            Multiplication Only

                                                            <mat-icon
                                                                class="active-icon s-14 ml-8 cursor-pointer"
                                                                color="accent"
                                                                matTooltip="Once activated, the benefits that will be awarded&#10;to the customer will be following the multiplication&#10;of the inputted value in the quantity above as&#10;If the multiplication rule is activated, you won't be&#10;able to add more tier."
                                                                matTooltipClass="tooltip-br"
                                                            >
                                                                help
                                                            </mat-icon>
                                                        </mat-checkbox>
                                                    </div>
                                                </div>
                                                <!-- ./ FIELD TIER MULTIPLICATION -->
                                            </ng-container>

                                            <ng-container
                                                *ngSwitchCase="eBenefitType.AMOUNT"
                                            ></ng-container>

                                            <ng-container
                                                *ngSwitchCase="eBenefitType.PERCENT"
                                            ></ng-container>
                                        </ng-container>
                                        <!-- ./ SWITCH CASE LAYOUT BENEFIT TYPE -->
                                    </div>
                                    <!-- ./ FIELD-WRAPPER -->

                                    <!-- START CARD-INSTRUCTION -->
                                    <card-instruction fxFlex="0 2 auto" *ngIf="isFirst">
                                        <p class="title">Sample Case</p>

                                        <p>
                                            Lorem ipsum dolor sit amet, consectetur adipiscing elit.
                                            Ut dignissim interdum accumsan. Sed pretium, felis sit
                                            amet finibus ullamcorper, elit ligula vehicula diam, eu
                                            posuere quam nibh ut elit. Nunc suscipit nisi id felis
                                            facilisis malesuada. Pellentesque suscipit venenatis
                                            neque, vel aliquet tortor dictum vitae. Mauris eu
                                            imperdiet nisl, pharetra condimentum lorem. Sed faucibus
                                            purus tortor, vel sagittis tortor maximus sed. Maecenas
                                            lorem arcu, porttitor non tellus ut, placerat
                                            sollicitudin nibh. Sed vel felis vitae augue dictum
                                            egestas elementum non nulla. Donec ut nunc neque.
                                        </p>
                                    </card-instruction>
                                    <!-- ./ CARD-INSTRUCTION -->
                                </div>
                            </div>
                            <!-- ./ DYNAMIC BOX-GROUP -->
                        </ng-container>
                    </div>

                    <div>
                        <ng-container *ngIf="canAddTier()">
                            <button
                                type="button"
                                mat-button
                                color="accent"
                                (click)="addCondition()"
                            >
                                Add Tier
                            </button>
                        </ng-container>

                        <ng-container *ngIf="!canAddTier()">
                            <button type="button" mat-button color="accent" disabled>
                                Add Tier
                            </button>
                        </ng-container>

                        <mat-icon
                            class="active-icon s-14 ml-8 cursor-pointer"
                            color="accent"
                            matTooltip="If the multiplication is activated, you&#10;cannot add another tier."
                            matTooltipClass="tooltip-br"
                        >
                            help
                        </mat-icon>
                    </div>
                </div>
            </mat-card>

            <mat-card class="mb-24">
                <div fxLayout="column">
                    <span class="mat-headline">
                        Customer Segmentation Setting
                    </span>

                    <div class="form-box">
                        <div
                            class="custom-field"
                            fxLayout="row"
                            fxLayoutAlign="start stretch"
                            fxLayoutGap="16px"
                        >
                            <label
                                fxFlexAlign="center"
                                fxFlex="10"
                                [class.sinbad-red-fg]="hasError('segmentationBase')"
                                fxFill
                            >
                                <span class="sinbad-red-fg">*</span>
                                Segmentation Base
                            </label>

                            <!-- <mat-form-field
                                appearance="outline"
                                fxFlex="50"
                                class="form-info"
                                [class.mat-form-field-invalid]="hasError('segmentationBase', true)"
                            >
                                <input matInput style="display: none;" />

                                <ng-container *ngIf="segmentBase; else noSegmentBase">
                                    <mat-radio-group
                                        formControlName="segmentationBase"
                                        (change)="onChangeSegmentBase($event)"
                                    >
                                        <mat-radio-button>None</mat-radio-button>
                                        <mat-radio-button
                                            *ngFor="let row of segmentBase"
                                            [value]="row?.id"
                                        >
                                            {{ row?.label }}
                                        </mat-radio-button>
                                    </mat-radio-group>
                                </ng-container>

                                <ng-template #noSegmentBase>
                                    <div fxFlexAlign="center" fxFlex="50">
                                        -
                                    </div>
                                </ng-template>

                                <mat-hint
                                    class="mat-error"
                                    *ngIf="hasError('segmentationBase', true)"
                                >
                                    {{ getErrorMessage('segmentationBase') }}
                                </mat-hint>

                                <mat-error *ngIf="hasError('segmentationBase', true)">
                                    {{ getErrorMessage('segmentationBase') }}
                                </mat-error>
                            </mat-form-field> -->

                            <div fxFlexAlign="center" fxFlex="50" fxFill>
                                <ng-container *ngIf="segmentBase; else noSegmentBase">
                                    <mat-radio-group
                                        formControlName="segmentationBase"
                                        (change)="onChangeSegmentBase($event)"
                                    >
                                        <mat-radio-button
                                            *ngFor="let row of segmentBase"
                                            [value]="row?.id"
                                        >
                                            {{ row?.label }}
                                        </mat-radio-button>
                                    </mat-radio-group>
                                </ng-container>

                                <ng-template #noSegmentBase>
                                    <div fxFlexAlign="center" fxFlex="50">
                                        -
                                    </div>
                                </ng-template>

                                <mat-hint
                                    class="mat-error"
                                    *ngIf="hasError('segmentationBase', true)"
                                >
                                    {{ getErrorMessage('segmentationBase') }}
                                </mat-hint>
                            </div>
                        </div>

                        <ng-container *ngIf="getSegmentationBase() === 'store'">
                            <div
                                class="custom-field"
                                fxLayout="row"
                                fxLayoutAlign="start stretch"
                                fxLayoutGap="16px"
                            >
                                <label
                                    fxFlexAlign="center"
                                    fxFlex="10"
                                    [class.sinbad-red-fg]="hasError('chosenStore')"
                                >
                                    Store<br />({{ form.get('chosenStore').value?.length || 0 }}
                                    Selected)
                                </label>

                                <select-supplier-stores
                                    placeholder="Choose Store"
                                    [required]="true"
                                    (selected)="onStoreSelected($event)"
                                    fxFlex="50"
                                >
                                    <div error>
                                        {{ getErrorMessage('chosenStore') }}
                                    </div>
                                </select-supplier-stores>
                            </div>
                        </ng-container>

                        <ng-container *ngIf="getSegmentationBase() === 'segmentation'">
                            <div
                                class="custom-field"
                                fxLayout="row"
                                fxLayoutAlign="start stretch"
                                fxLayoutGap="16px"
                            >
                                <label
                                    fxFlexAlign="center"
                                    fxFlex="10"
                                    [class.sinbad-red-fg]="hasError('chosenWarehouse')"
                                >
                                    Warehouse<br />({{
                                        form.get('chosenWarehouse').value?.length || 0
                                    }}
                                    Selected)
                                </label>

                                <select-warehouses
                                    placeholder="Choose Warehouse"
                                    [required]="false"
                                    (selected)="onWarehouseSelected($event)"
                                    fxFlex="50"
                                >
                                    <div error>
                                        {{ getErrorMessage('chosenWarehouse') }}
                                    </div>
                                </select-warehouses>
                            </div>

                            <div
                                class="custom-field"
                                fxLayout="row"
                                fxLayoutAlign="start stretch"
                                fxLayoutGap="16px"
                            >
                                <label
                                    fxFlexAlign="center"
                                    fxFlex="10"
                                    [class.sinbad-red-fg]="hasError('chosenStoreType')"
                                >
                                    Store Type<br />({{
                                        form.get('chosenStoreType').value?.length || 0
                                    }}
                                    Selected)
                                </label>

                                <select-store-segmentation
                                    placeholder="Choose Store Type"
                                    title="Select Store Type"
                                    segmentationType="type"
                                    [required]="false"
                                    (selected)="onStoreTypeSelected($event)"
                                    fxFlex="50"
                                >
                                    <div error>
                                        {{ getErrorMessage('chosenStoreType') }}
                                    </div>
                                </select-store-segmentation>
                            </div>

                            <div
                                class="custom-field"
                                fxLayout="row"
                                fxLayoutAlign="start stretch"
                                fxLayoutGap="16px"
                            >
                                <label
                                    fxFlexAlign="center"
                                    fxFlex="10"
                                    [class.sinbad-red-fg]="hasError('chosenStoreGroup')"
                                >
                                    Store Group<br />({{
                                        form.get('chosenStoreGroup').value?.length || 0
                                    }}
                                    Selected)
                                </label>

                                <select-store-segmentation
                                    placeholder="Choose Store Group"
                                    title="Select Store Group"
                                    segmentationType="group"
                                    [required]="false"
                                    (selected)="onStoreGroupSelected($event)"
                                    fxFlex="50"
                                >
                                    <div error>
                                        {{ getErrorMessage('chosenStoreGroup') }}
                                    </div>
                                </select-store-segmentation>
                            </div>

                            <div
                                class="custom-field"
                                fxLayout="row"
                                fxLayoutAlign="start stretch"
                                fxLayoutGap="16px"
                            >
                                <label
                                    fxFlexAlign="center"
                                    fxFlex="10"
                                    [class.sinbad-red-fg]="hasError('chosenStoreChannel')"
                                >
                                    Store Channel<br />({{
                                        form.get('chosenStoreChannel').value?.length || 0
                                    }}
                                    Selected)
                                </label>

                                <select-store-segmentation
                                    placeholder="Choose Store Channel"
                                    title="Select Store Channel"
                                    segmentationType="channel"
                                    [required]="false"
                                    (selected)="onStoreChannelSelected($event)"
                                    fxFlex="50"
                                >
                                    <div error>
                                        {{ getErrorMessage('chosenStoreChannel') }}
                                    </div>
                                </select-store-segmentation>
                            </div>

                            <div
                                class="custom-field"
                                fxLayout="row"
                                fxLayoutAlign="start stretch"
                                fxLayoutGap="16px"
                            >
                                <label
                                    fxFlexAlign="center"
                                    fxFlex="10"
                                    [class.sinbad-red-fg]="hasError('chosenStoreCluster')"
                                >
                                    Store Cluster<br />({{
                                        form.get('chosenStoreCluster').value?.length || 0
                                    }}
                                    Selected)
                                </label>

                                <select-store-segmentation
                                    placeholder="Choose Store Cluster"
                                    title="Select Store Cluster"
                                    segmentationType="cluster"
                                    [required]="false"
                                    (selected)="onStoreClusterSelected($event)"
                                    fxFlex="50"
                                >
                                    <div error>
                                        {{ getErrorMessage('chosenStoreCluster') }}
                                    </div>
                                </select-store-segmentation>
                            </div>
                        </ng-container>
                    </div>
                </div>
            </mat-card>
        </form>
    </div>
    <!-- / CENTER -->
</div>

<div class="loader" *ngIf="isLoading$ | async">
    <mat-spinner color="accent"></mat-spinner>
</div>
