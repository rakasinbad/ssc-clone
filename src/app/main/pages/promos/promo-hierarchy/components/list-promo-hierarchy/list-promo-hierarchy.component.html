<mat-table
    class="promo-hierarchy-list-table sinbad-table"
    [class.sinbad-table-no-record]="!(isLoading$ | async) && (totalDataSource$ | async) === 0"
    #table
    [dataSource]="dataSource$ | async"
    matSort
    [@animateStagger]="{ value: '50' }"
    fusePerfectScrollbar
>
    <!--  Promo Seller Id Column -->
    <ng-container matColumnDef="promo-seller-id">
        <mat-header-cell *matHeaderCellDef> Promo Seller ID </mat-header-cell>
        <mat-cell *matCellDef="let row">
            <p style="word-break: break-word">{{ row?.promoSellerId || '-' }}</p>
        </mat-cell>
    </ng-container>

    <!-- Promo Name Column -->
    <ng-container matColumnDef="promo-name">
        <mat-header-cell *matHeaderCellDef> Promo Name </mat-header-cell>
        <mat-cell *matCellDef="let row">
            <p style="word-break: break-word">{{ row?.name || '-' }}</p>
        </mat-cell>
    </ng-container>

    <!-- Promo Allocation Column -->
    <ng-container matColumnDef="promo-allocation">
        <mat-header-cell *matHeaderCellDef> Promo Allocation </mat-header-cell>
        <mat-cell *matCellDef="let row">
            <p style="word-break: break-word">
                {{
                    row?.promoAllocation === 'promo_slot' ||  row?.promoAllocation === 'voucher_slot'
                        ? 'Max Promo Redemption (Transaction)'
                        : row?.promoAllocation === 'promo_budget' ||  row?.promoAllocation === 'voucher_budget'
                        ? 'Max Promo Redemption (Rp)'
                        : row?.promoAllocation === 'none'
                        ? 'None'
                        : (row?.promoAllocation | titlecase) || '-'
                }}
            </p>
        </mat-cell>
    </ng-container>

    <!-- Allocation value Column -->
    <ng-container matColumnDef="allocation-value">
        <mat-header-cell *matHeaderCellDef> Allocation Value </mat-header-cell>
        <mat-cell *matCellDef="let row">
            <ng-container *ngIf="row?.promoAllocation == 'none'">
                <p style="word-break: break-word">-</p>
            </ng-container>
            <ng-container *ngIf="row?.promoAllocation == 'promo_budget'">
                <p style="word-break: break-word">
                    Rp {{ (row?.promoBudget | number) || '-' }}/Rp
                    {{ (row?.planBudget | number) || '-' }}
                </p>
            </ng-container>
            <ng-container *ngIf="row?.promoAllocation == 'promo_slot'">
                <p style="word-break: break-word">
                    {{ (row?.promoSlot | number) || 0 }}/{{ (row?.planSlot | number) || 0 }}
                </p>
            </ng-container>
        </mat-cell>
    </ng-container>

    <!-- Promo Type Column -->
    <ng-container matColumnDef="promo-type">
        <mat-header-cell *matHeaderCellDef> Promo Type </mat-header-cell>
        <mat-cell *matCellDef="let row">
            <p style="word-break: break-word">
                {{
                    row?.promoType === 'flexi'
                        ? 'Flexi Combo'
                        : row?.promoType === 'cross_selling'
                        ? 'Cross Selling'
                        : row?.promoType === 'voucher'
                        ? 'Supllier Voucher'
                        : (row?.promoType | titlecase) || '-'
                }}
            </p>
        </mat-cell>
    </ng-container>

    <!-- Promo Owner Column -->
    <ng-container matColumnDef="promo-group">
        <mat-header-cell *matHeaderCellDef> Promo Owner </mat-header-cell>
        <mat-cell *matCellDef="let row">
            <p style="word-break: break-word">
                {{
                    row?.promoOwner === 'sinbad-promo'
                        ? 'Sinbad Promo'
                        : row?.promoOwner === 'distributor-promo'
                        ? 'Distributor'
                        : row?.promoOwner === 'principal-promo'
                        ? 'Principal'
                        : row?.promoOwner === 'none'
                        ? 'None'
                        : row?.promoOwner === 'payment-method-promo'
                        ? 'Payment Method Promo'
                        : (row?.promoOwner | titlecase) || '-'
                }}
            </p>
        </mat-cell>
    </ng-container>

    <!-- Status Column -->
    <ng-container matColumnDef="status">
        <mat-header-cell *matHeaderCellDef> Status </mat-header-cell>
        <mat-cell *matCellDef="let row">
            <ng-container *ngIf="row?.status; else noStatus">
                <mat-icon
                    class="active-icon s-24"
                    [matTooltip]="row?.status | titlecase"
                    svgIcon="sinbad-check-active"
                    *ngIf="row?.status === 'active'"
                >
                </mat-icon>

                <mat-icon
                    class="active-icon s-24"
                    [matTooltip]="row?.status | titlecase"
                    svgIcon="sinbad-check-inactive"
                    *ngIf="row?.status === 'inactive'"
                >
                </mat-icon>
            </ng-container>

            <ng-template #noStatus> - </ng-template>
        </mat-cell>
    </ng-container>

    <!-- Actions Column -->
    <ng-container matColumnDef="actions">
        <mat-header-cell *matHeaderCellDef> Actions </mat-header-cell>
        <mat-cell *matCellDef="let row">
            <div fxFlex="row" fxLayoutAlign="end center">
                <button
                    mat-icon-button
                    [matMenuTriggerFor]="moreMenu"
                    aria-label="More"
                    (click)="$event.stopPropagation()"
                >
                    <mat-icon class="secondary-text">more_vert</mat-icon>
                </button>

                <mat-menu #moreMenu="matMenu">
                    <ng-template [ngxPermissionsOnly]="['SRM.SR.UPDATE']">
                        <button
                            type="button"
                            mat-menu-item
                            class="sinbad-mat-menu-item"
                            aria-label="Settings"
                            (click)="settingPromoHierarchy(row)"
                        >
                            <mat-icon>settings</mat-icon>
                            <span>Set</span>
                        </button>
                        <button
                            type="button"
                            mat-menu-item
                            class="sinbad-mat-menu-item"
                            aria-label="Detail"
                            (click)="openDetailPage(row)"
                            [routerLink]="[row?.id, 'detail']"
                        >
                            <mat-icon>remove_red_eye</mat-icon>
                            <span>Detail</span>
                        </button>
                    </ng-template>
                </mat-menu>
            </div>
        </mat-cell>
    </ng-container>

    <!-- No Record Column -->
    <ng-container matColumnDef="no-record">
        <mat-footer-cell *matFooterCellDef colspan="8"> No records found </mat-footer-cell>
    </ng-container>

    <mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></mat-header-row>

    <mat-row
        *matRowDef="let row; columns: displayedColumns"
        class="sinbad-promo-hierarchy-list-item"
        [routerLink]="[row?.id, 'detail']"
        (click)="openDetailPage(row)"
    ></mat-row>

    <mat-footer-row
        *matFooterRowDef="['no-record']"
        [fxShow]="!(isLoading$ | async) && (totalDataSource$ | async) === 0"
    ></mat-footer-row>
</mat-table>

<div
    class="loader-content"
    *ngIf="(isLoading$ | async) && (!(totalDataSource$ | async) || (totalDataSource$ | async))"
>
    <mat-spinner color="accent"></mat-spinner>
</div>

<mat-paginator
    [disabled]="
        ((isLoading$ | async) && !(totalDataSource$ | async)) ||
        (!(isLoading$ | async) && (totalDataSource$ | async) === 0)
    "
    [length]="totalDataSource$ | async"
    [pageSize]="defaultPageSize"
    [pageSizeOptions]="defaultPageOpts"
    showFirstLastButtons
></mat-paginator>
