<mat-table
    class="store-employee-component-table mt-12 ml-12"
    #table
    [dataSource]="dataSource$ | async"
    [trackBy]="onTrackBy"
    matSort
    [@animateStagger]="{ value: '50' }"
    fusePerfectScrollbar
>
    <!-- Name Column -->
    <ng-container matColumnDef="name">
        <mat-header-cell *matHeaderCellDef>
            Name
        </mat-header-cell>
        <mat-cell *matCellDef="let row">
            <p style="word-break: break-word;">
                {{ safeValue(row?.user?.fullName) }}
            </p>
        </mat-cell>
    </ng-container>

    <!-- Role Column -->
    <ng-container matColumnDef="role">
        <mat-header-cell *matHeaderCellDef>
            Role
        </mat-header-cell>
        <mat-cell *matCellDef="let row">
            <p style="word-break: break-word;" [innerHTML]="joinRoles(row?.user?.roles)"></p>
        </mat-cell>
    </ng-container>

    <!-- Phone Number Column -->
    <ng-container matColumnDef="phone-no">
        <mat-header-cell *matHeaderCellDef>
            Phone Number
        </mat-header-cell>
        <mat-cell *matCellDef="let row">
            <p style="word-break: break-word;">
                {{ safeValue(row?.user?.mobilePhoneNo) }}
            </p>
        </mat-cell>
    </ng-container>

    <!-- Last Check In Column -->
    <ng-container matColumnDef="last-check-in">
        <mat-header-cell *matHeaderCellDef>
            Last Checked-in
        </mat-header-cell>

        <mat-cell *matCellDef="let row">
            <p style="word-break: break-word;">
                {{
                    safeValue((row?.user?.attendances)[0]?.checkIn) !== '-'
                        ? ((row?.user?.attendances)[0]?.checkIn | date: 'dd/MM/yyyy HH:mm:ss')
                        : safeValue((row?.user?.attendances)[0]?.checkIn)
                }}
            </p>
        </mat-cell>
    </ng-container>

    <!-- Status Column -->
    <ng-container matColumnDef="status">
        <mat-header-cell *matHeaderCellDef>
            Status
        </mat-header-cell>

        <mat-cell *matCellDef="let row">
            <ng-container *ngIf="safeValue(row?.status) !== '-'">
                <mat-icon
                    class="indicator-success active-icon s-24"
                    [matTooltip]="row?.status | titlecase"
                    svgIcon="sinbad-check-active"
                    *ngIf="row?.status === 'active'"
                ></mat-icon>

                <mat-icon
                    class="indicator-error active-icon s-24"
                    [matTooltip]="row?.status | titlecase"
                    svgIcon="sinbad-check-inactive"
                    *ngIf="row?.status === 'inactive'"
                ></mat-icon>
            </ng-container>

            <ng-container *ngIf="safeValue(row?.status) === '-'">
                {{ safeValue(row?.status) }}
            </ng-container>
        </mat-cell>
    </ng-container>

    <ng-container matColumnDef="actions">
        <mat-header-cell *matHeaderCellDef>
            Actions
        </mat-header-cell>
        <mat-cell *matCellDef="let row">
            <div
                fxFlex="row"
                fxLayoutAlign="end center"
                *ngIf="(auth$ | async)?.user?.id !== row?.userId"
            >
                <button
                    mat-icon-button
                    [matMenuTriggerFor]="moreMenu"
                    aria-label="More"
                    (click)="$event.stopPropagation()"
                >
                    <mat-icon class="secondary-text">more_vert</mat-icon>
                </button>

                <mat-menu #moreMenu="matMenu">
                    <ng-template [ngxPermissionsOnly]="['ACCOUNT.STORE.EMPLOYEE.UPDATE']">
                        <button
                            mat-menu-item
                            type="button"
                            class="sinbad-mat-menu-item"
                            aria-label="Edit"
                            [routerLink]="[
                                '/pages/account/stores',
                                supplierStoreId,
                                row?.storeId,
                                row?.userId,
                                'employee'
                            ]"
                        >
                            <mat-icon>edit</mat-icon>
                            <span>Edit</span>
                        </button>
                    </ng-template>

                    <ng-template [ngxPermissionsOnly]="['ACCOUNT.STORE.EMPLOYEE.DELETE']">
                        <button
                            mat-menu-item
                            type="button"
                            class="sinbad-mat-menu-item"
                            aria-label="Delete"
                            *ngIf="!hasOwnerRoles(row?.user?.roles)"
                            (click)="onDelete(row)"
                        >
                            <mat-icon>delete</mat-icon>
                            <span>Delete</span>
                        </button>
                    </ng-template>

                    <ng-template [ngxPermissionsOnly]="['ACCOUNT.STORE.EMPLOYEE.UPDATE']">
                        <button
                            mat-menu-item
                            type="button"
                            class="sinbad-mat-menu-item"
                            [attr.aria-label]="row?.status === 'active' ? 'inactive' : 'active'"
                            *ngIf="!hasOwnerRoles(row?.user?.roles)"
                            (click)="onChangeStatus(row)"
                        >
                            <mat-icon>
                                {{ row?.status === 'active' ? 'archive' : 'check_circle_outline' }}
                            </mat-icon>
                            <span>
                                {{
                                    (row?.status === 'active'
                                        ? 'ACTION.INACTIVE'
                                        : 'ACTION.ACTIVE'
                                    ) | translate
                                }}
                            </span>
                        </button>
                    </ng-template>
                </mat-menu>
            </div>
        </mat-cell>
    </ng-container>

    <mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></mat-header-row>

    <mat-row
        *matRowDef="let row; columns: displayedColumns"
        class="merchant-employee"
        [ngClass]="{ 'highlight-row': (selectedRowIndex$ | async) === row?.userId }"
        matRipple
        [routerLink]="[
            '/pages/account/stores',
            supplierStoreId,
            row?.storeId,
            row?.userId,
            'employee'
        ]"
    >
    </mat-row>
</mat-table>

<div class="no-records" *ngIf="(isLoading$ | async) && !(totalDataSource$ | async)">
    <mat-spinner color="accent"></mat-spinner>
</div>

<!-- <div class="no-records" *ngIf="!(isLoading$ | async) && (totalDataSource$ | async) === 0">
    No records found
</div> -->

<mat-paginator
    [fxHide]="
        ((isLoading$ | async) && !(totalDataSource$ | async)) ||
        (!(isLoading$ | async) && (totalDataSource$ | async) === 0)
    "
    [length]="totalDataSource$ | async"
    [pageSize]="defaultPageSize"
    [pageSizeOptions]="defaultPageOpts"
    (page)="onChangePage($event)"
    showFirstLastButtons
>
</mat-paginator>
