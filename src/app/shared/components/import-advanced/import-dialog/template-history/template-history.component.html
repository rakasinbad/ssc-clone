<div class="section pb-44" fxLayout="column">
    <div class="header-wrapper mb-16" fxLayout="row" fxLayoutAlign="start center">
        <button type="button" mat-flat-button class="sinbad-orange mr-16">
            Refresh
        </button>

        <div class="search-wrapper mx-32 mx-md-0">
            <div class="search" fxFlex fxLayout="row" fxLayoutAlign="start center">
                <input matInput placeholder="Search" />
                <mat-icon>search</mat-icon>
            </div>
        </div>
    </div>

    <table
        mat-table
        [dataSource]="dataSource$ | async"
        matSort
        [@animateStagger]="{ value: '50' }"
        class="simple"
    >
        <!-- ID Column -->
        <ng-container matColumnDef="id">
            <th mat-header-cell *matHeaderCellDef>
                #
            </th>
            <td mat-cell *matCellDef="let row">
                {{ row?.id || '-' }}
            </td>
        </ng-container>

        <!-- Date Column -->
        <ng-container matColumnDef="date">
            <th mat-header-cell *matHeaderCellDef>Created</th>
            <td mat-cell *matCellDef="let row">
                {{ (row?.createdAt | date: 'MMM dd, yyyy h:mm:ss aa') || '-' }}
            </td>
        </ng-container>

        <!-- Action Column -->
        <ng-container matColumnDef="action">
            <th mat-header-cell *matHeaderCellDef>Type</th>
            <td mat-cell *matCellDef="let row">
                {{ row.action || '-' }}
            </td>
        </ng-container>

        <!-- Username Column -->
        <ng-container matColumnDef="username">
            <th mat-header-cell *matHeaderCellDef>Username</th>
            <td mat-cell *matCellDef="let row">
                {{ row?.user?.fullName || '-' }}
            </td>
        </ng-container>

        <!-- Status Column -->
        <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef>Status</th>
            <td mat-cell *matCellDef="let row">
                <ng-container *ngIf="row?.status">
                    <mat-icon
                        class="active-icon s-16"
                        [matTooltip]="convertStatus('progress', row?.status) | titlecase"
                        svgIcon="sinbad-check-active"
                        *ngIf="row?.status === 'done'"
                    >
                    </mat-icon>

                    <mat-icon
                        class="active-icon s-16"
                        [matTooltip]="convertStatus('progress', row?.status) | titlecase"
                        svgIcon="sinbad-pending"
                        *ngIf="row?.status === 'pending'"
                    >
                    </mat-icon>

                    <mat-icon
                        class="active-icon s-16"
                        [matTooltip]="convertStatus('progress', row?.status) | titlecase"
                        svgIcon="sinbad-on-process"
                        *ngIf="row?.status === 'on_process'"
                    >
                    </mat-icon>

                    <mat-icon
                        class="active-icon s-16"
                        [matTooltip]="convertStatus('progress', row?.status) | titlecase"
                        svgIcon="sinbad-cross-red"
                        *ngIf="row?.status === 'failed'"
                    >
                    </mat-icon>
                </ng-container>

                <ng-container *ngIf="!row?.status">
                    -
                </ng-container>
            </td>
        </ng-container>

        <!-- Download Column -->
        <ng-container matColumnDef="download">
            <th mat-header-cell *matHeaderCellDef>Download</th>
            <td mat-cell *matCellDef="let row">
                <a
                    href="javascript:;"
                    *ngIf="row?.status === 'done'"
                    (click)="onDownload(row?.url)"
                >
                    Download
                </a>

                <ng-container *ngIf="row?.status !== 'done'">
                    {{ convertStatus('progress', row?.status) }}
                </ng-container>
            </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
    </table>

    <div class="no-records" *ngIf="(isLoading$ | async) && !(totalDataSource$ | async)">
        <mat-spinner color="accent"></mat-spinner>
    </div>

    <div class="no-records" *ngIf="!(isLoading$ | async) && (totalDataSource$ | async) === 0">
        No records found
    </div>

    <mat-paginator
        [fxHide]="
            ((isLoading$ | async) && !(totalDataSource$ | async)) ||
            (!(isLoading$ | async) && (totalDataSource$ | async) === 0)
        "
        [length]="totalDataSource$ | async"
        [pageSize]="defaultPageSize"
        [pageSizeOptions]="defaultPageOpts"
        showFirstLastButtons
    ></mat-paginator>
</div>
